name = "stockiha"
compatibility_date = "2024-01-15"
compatibility_flags = ["nodejs_compat"]

[env.production]
name = "stockiha"

[env.preview]
name = "stockiha-preview"

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡
[build]
command = "pnpm run build"
cwd = "."

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø´Ø±
pages_build_output_dir = "dist"

# Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¹Ø§Ù…Ø© (ØºÙŠØ± Ø­Ø³Ø§Ø³Ø©)
[vars]
NODE_ENV = "production"
VITE_ENABLE_SECURITY_HEADERS = "true"
VITE_ENABLE_CSP = "true"
VITE_ENABLE_RATE_LIMITING = "true"

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Functions Ù…Ø¹ Ø£Ù…Ø§Ù† Ù…ØªÙ‚Ø¯Ù…
[[pages.functions]]
pattern = "/api/*"
compatibility_date = "2024-01-15"
compatibility_flags = ["nodejs_compat"]

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Rate Limiting
[pages.functions.limits]
cpu_ms = 50
memory_mb = 128

# ðŸ”’ Security Headers - Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ù…Ø§Ù† Ù…ØªÙ‚Ø¯Ù…Ø©
[[pages.headers]]
for = "/*"
[pages.headers.values]
# Security Headers
X-Frame-Options = "SAMEORIGIN"
X-Content-Type-Options = "nosniff"
X-XSS-Protection = "1; mode=block"
Referrer-Policy = "strict-origin-when-cross-origin"
Permissions-Policy = "camera=(), microphone=(), geolocation=(), payment=()"
Strict-Transport-Security = "max-age=31536000; includeSubDomains; preload"

# Custom Headers
X-Store-Type = "dynamic"
X-Instagram-WebView = "enabled"

# Content Security Policy - Ø£Ù…Ø§Ù† Ù…ØªÙ‚Ø¯Ù…
Content-Security-Policy = "default-src 'self'; script-src 'self' 'unsafe-inline' https://connect.facebook.net https://www.googletagmanager.com https://www.google-analytics.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https: blob:; font-src 'self' https://fonts.gstatic.com data:; connect-src 'self' https://*.supabase.co wss://*.supabase.co https://api.yalidine.app; frame-src 'self' https://www.facebook.com https://connect.facebook.net; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'self' https://www.instagram.com https://*.instagram.com https://www.facebook.com https://*.facebook.com; upgrade-insecure-requests;"

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Cache Ù„Ù„Ù€ Assets
[[pages.headers]]
for = "/assets/*"
[pages.headers.values]
Cache-Control = "public, max-age=31536000, immutable"

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Cache Ù„Ù„Ø®Ø·ÙˆØ·
[[pages.headers]]
for = "/assets/fonts/*"
[pages.headers.values]
Cache-Control = "public, max-age=31536000, immutable"
Access-Control-Allow-Origin = "*"

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Content-Type Ù„Ù„Ù€ JavaScript
[[pages.headers]]
for = "/*.js"
[pages.headers.values]
Content-Type = "text/javascript; charset=utf-8"

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Content-Type Ù„Ù„Ù€ CSS
[[pages.headers]]
for = "/*.css"
[pages.headers.values]
Content-Type = "text/css; charset=utf-8"

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Rewrites
[[pages.redirects]]
from = "/yalidine-api/*"
to = "/api/yalidine-fees-proxy"
status = 200

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª CORS
[[pages.headers]]
for = "/api/*"
[pages.headers.values]
Access-Control-Allow-Origin = "*"
Access-Control-Allow-Methods = "GET, POST, PUT, DELETE, PATCH, OPTIONS"
Access-Control-Allow-Headers = "Content-Type, Authorization, X-Requested-With, Accept, Origin, X-API-ID, X-API-TOKEN"
