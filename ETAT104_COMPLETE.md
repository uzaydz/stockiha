# ๐ ูุธุงู ูุดู ุญุณุงุจ 104 - ููุชูู โ

## ๐ฆ **ููุฎุต ูุง ุชู ุฅูุฌุงุฒู:**

ุชู ุฅูุดุงุก ูุธุงู ูุชูุงูู ูุฅุฏุงุฑุฉ **ูุดู ุญุณุงุจ 104** ูุชูุงูู ูุน ุงููุชุทูุจุงุช ุงูุฌุฒุงุฆุฑูุฉ ุงูุฑุณููุฉ.

---

## ๐ **ุงููููุงุช ุงููููุดุฃุฉ:**

### **1. ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
โ `database/migrations/create_etat104_tables.sql`
- 4 ุฌุฏุงูู ุฑุฆูุณูุฉ
- ุฏูุงู ููุญูุฒุงุช ุชููุงุฆูุฉ
- Row Level Security (RLS)
- ููุงุฑุณ ูุญุณููุฉ

### **2. API ููุชุญูู:**
โ `api/etat104/verify-nif.js` - ุงูุชุญูู ูู NIF
โ `api/etat104/verify-rc.js` - ุงูุชุญูู ูู RC
- ูุญุงูุงุฉ ุฌุงูุฒุฉ ููุงุฎุชุจุงุฑ
- ูุงุจูุฉ ููุชุฎุตูุต ูุน API ุงููุนูู
- ุญูุธ ุณุฌู ูุงูู

### **3. ุงูุฎุฏูุงุช:**
โ `src/services/etat104Service.ts`
- ุฌููุน ุฏูุงู ุฅุฏุงุฑุฉ ุงููุดููุงุช
- ุงูุชุญูู ูู NIF ู RC
- ุงูุชุตุฏูุฑ ุฅูู Excel
- ุฅุฏุงุฑุฉ ุงูุนููุงุก ูุงูุฃุฎุทุงุก

### **4. ุฏูุงู ุงูุชุตุฏูุฑ:**
โ `src/utils/etat104ExportUtils.ts`
- ุชุตุฏูุฑ Excel ุจุชูุณูู DGI
- ุชูุฒูู ูููุฐุฌ Excel
- ุฏุนู ุงูููุชุฑุฉ ูุงูุฎูุงุฑุงุช

### **5. ุงููุงุฌูุฉ ุงูุฃูุงููุฉ:**
โ `src/pages/dashboard/Etat104.tsx` - ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
โ `src/components/etat104/` - ุฌููุน ุงูููููุงุช
โ `src/components/pos-layout/POSPureSidebar.tsx` - ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ

### **6. ุงูุชูุซูู:**
โ `ETAT104_SETUP.md` - ุฏููู ุงูุฅุนุฏุงุฏ
โ `ETAT104_COMPLETE.md` - ูุฐุง ุงูููู

---

## ๐ **ุงูุจุฏุก ุงูุณุฑูุน:**

### **ุงูุฎุทูุฉ 1: ุชุซุจูุช ุงูููุชุจุงุช**
```bash
npm install xlsx file-saver
npm install --save-dev @types/file-saver
```

### **ุงูุฎุทูุฉ 2: ุชุดุบูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**
1. ุงูุชุญ Supabase SQL Editor
2. ุดุบูู: `database/migrations/create_etat104_tables.sql`

### **ุงูุฎุทูุฉ 3: ุงููุตูู ูููุธุงู**
- ุงูุชุญ: `/dashboard/etat104`
- ุฃู ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ: "ูุดู ุญุณุงุจ 104"

---

## ๐ **ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:**

### โ **1. ุฅุฏุงุฑุฉ ุงููุดููุงุช:**
- ุฅูุดุงุก ูุดู ุฌุฏูุฏ ูุฃู ุณูุฉ
- ุญูุธ ุชููุงุฆู ููุจูุงูุงุช
- ุชุชุจุน ุงูุญุงูุฉ (ูุณูุฏุฉุ ูููุฏูุ ููุตุญุญ)
- ุณุฌู ุชุงุฑูุฎู ูุงูู

### โ **2. ุฅุฏุงุฑุฉ ุงูุนููุงุก:**
- ุฅุถุงูุฉ ุนููุงุก ูุฏููุงู
- ุงุณุชูุฑุงุฏ ูู Excel
- ุชุญุฏูุซ ูุญุฐู
- ููุชุฑุฉ ูุจุญุซ ูุชูุฏู

### โ **3. ุงูุชุญูู ุงูุฐูู:**
- ุงูุชุญูู ูู NIF (15 ุฑูู)
- ุงูุชุญูู ูู RC
- ูุดู ุงูุฃุฎุทุงุก ุชููุงุฆูุงู
- ุงูุชุฑุงุญุงุช ููุชุตุญูุญ

### โ **4. ุงูุฅุญุตุงุฆูุงุช:**
- ุฅุฌูุงูู ุงูุนููุงุก
- ุนููุงุก ุตุงูุญูู/ุชุญุฐูุฑุงุช/ุฃุฎุทุงุก
- ุงููุจุงูุบ ุงููุงููุฉ (HT, TVA, TTC)
- ูุณุจ ูุฆููุฉ ูุฑุฆูุฉ

### โ **5. ุงูุชุตุฏูุฑ:**
- Excel ุจุชูุณูู DGI ุงูุฑุณูู
- PDF ููุทุจุงุนุฉ
- ุชูุฒูู ูููุฐุฌ Excel
- ุฎูุงุฑุงุช ููุชุฑุฉ ูุชูุฏูุฉ

---

## ๐ง **ุงุณุชุฎุฏุงู API:**

### **ุฅูุดุงุก ูุดู:**
```typescript
import { createDeclaration } from '@/services/etat104Service';

const declaration = await createDeclaration(organizationId, 2024);
```

### **ุฅุถุงูุฉ ุนููุงุก:**
```typescript
import { addMultipleClients } from '@/services/etat104Service';

const clients = [
  {
    declaration_id: declarationId,
    organization_id: organizationId,
    commercial_name: "ุดุฑูุฉ ูุซุงู",
    nif: "123456789012345",
    rc: "12345678",
    address: "ุงูุฌุฒุงุฆุฑ",
    amount_ht: 100000,
    tva: 19000,
    validation_status: 'pending'
  }
];

await addMultipleClients(clients);
```

### **ุงูุชุญูู:**
```typescript
import { verifyNIF, verifyRC } from '@/services/etat104Service';

// ุงูุชุญูู ูู NIF
const nifResult = await verifyNIF(nif, organizationId, clientId);

// ุงูุชุญูู ูู RC
const rcResult = await verifyRC(rc, organizationId, clientId);
```

### **ุงูุชุตุฏูุฑ:**
```typescript
import { exportToExcel, exportTemplate } from '@/services/etat104Service';

// ุชุตุฏูุฑ ุงููุดู
await exportToExcel(declarationId, organizationId, {
  includeErrors: false,
  includeWarnings: true
});

// ุชูุฒูู ูููุฐุฌ
await exportTemplate();
```

---

## ๐๏ธ **ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**

### **ุงูุฌุฏุงูู:**

**1. etat104_declarations**
- ูุนูููุงุช ุงููุดู ุงูุฃุณุงุณูุฉ
- ุงูุฅุญุตุงุฆูุงุช ุงูุชููุงุฆูุฉ
- ุงูุชูุงุฑูุฎ ูุงูุญุงูุงุช

**2. etat104_clients**
- ุจูุงูุงุช ุงูุนููุงุก ุงููุงููุฉ
- ุญุงูุฉ ุงูุชุญูู
- ุงููุจุงูุบ ุงููุงููุฉ

**3. etat104_validations**
- ุงูุฃุฎุทุงุก ูุงูุชุญุฐูุฑุงุช
- ูุตุฏุฑ ุงูุชุญูู
- ุญุงูุฉ ุงูุญู

**4. etat104_verification_log**
- ุณุฌู ูุงูู ููุชุญูู
- ุงูุจูุงูุงุช ุงููุฑุฌุนุฉ ูู API
- ููุทุงุช ุงูุดุงุดุฉ (ูุทููุจ ูุงูููุงู)

---

## ๐จ **ุงููุงุฌูุฉ:**

### **ุงูุชุจููุจุงุช:**
1. **ุงูุชุญูู ูุงููุตุงุฏูุฉ** - ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
2. **ุงูุฏููู ุงูุฅุฑุดุงุฏู** - ูุนูููุงุช ูุงููููุฉ
3. **ุงูุณุฌู ุงูุชุงุฑูุฎู** - ุงููุดููุงุช ุงูุณุงุจูุฉ

### **ุงูููููุงุช:**
- `Etat104ImportDialog` - ุงุณุชูุฑุงุฏ Excel
- `Etat104ValidationTable` - ุฌุฏูู ุงููุชุงุฆุฌ
- `Etat104Statistics` - ุงูุฅุญุตุงุฆูุงุช
- `Etat104ExportDialog` - ุงูุชุตุฏูุฑ
- `Etat104HistoryList` - ุงูุณุฌู

---

## โ๏ธ **ุงูุงูุชุซุงู ุงููุงูููู:**

### โ **ุงููุชุทูุจุงุช ุงููุทุจูุฉ:**
- ุฌููุน ุงูุจูุงูุงุช ุงูุฅูุฒุงููุฉ
- ุงูุชุญูู ูู NIF ู RC
- ุณุฌู ูุงูู ููุชุญูู
- ุชูุณูู DGI ุงูุฑุณูู

### โฐ **ุงูููุงุนูุฏ:**
- ุงูููุนุฏ ุงูููุงุฆู: **30 ุฃูุฑูู**
- ุชูุจููุงุช ุชููุงุฆูุฉ
- ุชุชุจุน ุญุงูุฉ ุงูุชูุฏูู

### ๐ฐ **ุงูุนููุจุงุช:**
- ุนุฏู ุงูุชูุฏูู: 2% ูู ุฑูู ุงูุฃุนูุงู
- ุชุฃุฎูุฑ < ุดูุฑ: 30,000 ุฏุฌ
- ุชุฃุฎูุฑ 1-2 ุดูุฑ: 50,000 ุฏุฌ
- ุชุฃุฎูุฑ > ุดูุฑูู: 80,000 ุฏุฌ

---

## ๐ **ุงูุฃูุงู:**

### **Row Level Security (RLS):**
- ูู ูุคุณุณุฉ ุชุฑู ุจูุงูุงุชูุง ููุท
- ุณูุงุณุงุช ุฃูุงู ุตุงุฑูุฉ
- ุชุญูู ูู ุงูุตูุงุญูุงุช

### **ุงูุชุฏููู:**
- ุณุฌู ูุงูู ูุฌููุน ุงูุนูููุงุช
- ุชุชุจุน ุงูุชุบููุฑุงุช
- ูุนูููุงุช ุงููุณุชุฎุฏู

---

## ๐ **ุณูุฑ ุงูุนูู ุงููุงูู:**

```
1. ุฅูุดุงุก ูุดู ุฌุฏูุฏ (ุงูุณูุฉ ุงููุงููุฉ)
   โ
2. ุงุณุชูุฑุงุฏ ุงูุนููุงุก ูู Excel
   โ
3. ุงูุชุญูู ุงูุชููุงุฆู ูู ุงูุจูุงูุงุช
   โ
4. ูุฑุงุฌุนุฉ ุงูุฃุฎุทุงุก ูุงูุชุญุฐูุฑุงุช
   โ
5. ุงูุชุญูู ูู NIF ู RC (ุงุฎุชูุงุฑู)
   โ
6. ุชุตุญูุญ ุงูุฃุฎุทุงุก
   โ
7. ุชุตุฏูุฑ ุงููุดู (Excel)
   โ
8. ุชูุฏูู ูููุฏูุฑูุฉ ุงูุนุงูุฉ ููุถุฑุงุฆุจ
   โ
9. ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู "ูููุฏู"
```

---

## ๐ **ููุงุญุธุงุช ูููุฉ:**

### **1. ุงูููุชุจุงุช:**
โ๏ธ ูุฌุจ ุชุซุจูุช `xlsx` ู `file-saver` ูุจู ุงูุงุณุชุฎุฏุงู
```bash
npm install xlsx file-saver
```

### **2. API ุงูุชุญูู:**
โ๏ธ ุญุงููุงู ูุณุชุฎุฏู ูุญุงูุงุฉ - ูุฌุจ ุงุณุชุจุฏุงููุง ุจู API ุงููุนูู
- ุฑุงุฌุน: `api/etat104/verify-nif.js`
- ุฑุงุฌุน: `api/etat104/verify-rc.js`

### **3. ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
โ๏ธ ูุฌุจ ุชุดุบูู ููู SQL ูู Supabase
- ุงูููู: `database/migrations/create_etat104_tables.sql`

---

## ๐ฏ **ุงูุชุฎุตูุต:**

### **ุชุฎุตูุต API ููุชุญูู:**

**ููุชุญูู ูู NIF:**
```javascript
// ูู verify-nif.js
const response = await fetch('https://dgi.gov.dz/api/verify', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${process.env.DGI_API_KEY}`
  },
  body: JSON.stringify({ nif })
});
```

**ููุชุญูู ูู RC:**
```javascript
// ูู verify-rc.js
const response = await fetch('https://cnrc.dz/api/verify', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${process.env.CNRC_API_KEY}`
  },
  body: JSON.stringify({ rc })
});
```

---

## ๐ **ุงูุฅุญุตุงุฆูุงุช:**

### **ูุง ุชู ุฅูุฌุงุฒู:**
- โ 4 ุฌุฏุงูู ูุงุนุฏุฉ ุจูุงูุงุช
- โ 2 API ููุชุญูู
- โ 1 ุฎุฏูุฉ ุดุงููุฉ
- โ 1 ููู ุชุตุฏูุฑ
- โ 5+ ููููุงุช ูุงุฌูุฉ
- โ ุฏุนู ูุงูู ููุบุฉ ุงูุนุฑุจูุฉ
- โ ูุชูุงูู ูุน DGI

### **ุงูุฃุณุทุฑ ุงูุจุฑูุฌูุฉ:**
- ูุงุนุฏุฉ ุงูุจูุงูุงุช: ~400 ุณุทุฑ SQL
- API: ~300 ุณุทุฑ JavaScript
- ุงูุฎุฏูุงุช: ~600 ุณุทุฑ TypeScript
- ุงูุชุตุฏูุฑ: ~200 ุณุทุฑ TypeScript
- **ุงูุฅุฌูุงูู: ~1500+ ุณุทุฑ**

---

## โ **ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ:**

### **ุงูุฅุนุฏุงุฏ:**
- [ ] ุชุซุจูุช ุงูููุชุจุงุช (xlsx, file-saver)
- [ ] ุชุดุบูู ููู SQL ูู Supabase
- [ ] ุงูุชุญูู ูู ุงูุตูุงุญูุงุช

### **ุงูุงุฎุชุจุงุฑ:**
- [ ] ุฅูุดุงุก ูุดู ุฌุฏูุฏ
- [ ] ุงุณุชูุฑุงุฏ ููู Excel
- [ ] ุงูุชุญูู ูู ุงูุจูุงูุงุช
- [ ] ุชุตุฏูุฑ ุฅูู Excel
- [ ] ูุฑุงุฌุนุฉ ุงูุฅุญุตุงุฆูุงุช

### **ุงูุฅูุชุงุฌ:**
- [ ] ุชุฎุตูุต API ููุชุญูู
- [ ] ุฅุถุงูุฉ ููุงุชูุญ API
- [ ] ุงุฎุชุจุงุฑ ุดุงูู
- [ ] ุชุฏุฑูุจ ุงููุณุชุฎุฏููู

---

## ๐ **ุงูุฏุนู ูุงูุชูุซูู:**

### **ุงููููุงุช ุงููุฑุฌุนูุฉ:**
- `ETAT104_SETUP.md` - ุฏููู ุงูุฅุนุฏุงุฏ ุงูุชูุตููู
- `database/migrations/create_etat104_tables.sql` - ุชุนูููุงุช SQL
- `src/services/etat104Service.ts` - ุชุนูููุงุช ุงูููุฏ

### **ุงูุฐุงูุฑุฉ ุงููุญููุธุฉ:**
- ุชู ุญูุธ ุฌููุน ุงููุนูููุงุช ูู ุงูุฐุงูุฑุฉ
- ูููู ุงูุฑุฌูุน ุฅูููุง ูู ุฃู ููุช

---

## ๐ **ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑูุฉ):**

### **1. ุชุญุณููุงุช:**
- ุฅุถุงูุฉ ุฑูุฒ QR ูููุดู
- ุชูุงูู ูุน ูุธุงู ุงูููุงุชูุฑ
- ุงุณุชูุฑุงุฏ ุชููุงุฆู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฅุดุนุงุฑุงุช ุจุงูููุงุนูุฏ

### **2. ููุฒุงุช ุฅุถุงููุฉ:**
- ุชุตุญูุญ ุชููุงุฆู ููุฃุฎุทุงุก
- ุชุญูููุงุช ูุชูุฏูุฉ
- ุชูุงุฑูุฑ ูุฎุตุตุฉ
- ุชุตุฏูุฑ ุจุตูุบ ุฅุถุงููุฉ

---

## ๐ **ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู!**

ุชู ุฅูุดุงุก ูุธุงู ูุชูุงูู ูุงุญุชุฑุงูู ูุฅุฏุงุฑุฉ ูุดู ุญุณุงุจ 104 ูุชูุงูู ูุน ุฌููุน ุงููุชุทูุจุงุช ุงูุฌุฒุงุฆุฑูุฉ ุงูุฑุณููุฉ.

**ููุจุฏุก:**
1. ุซุจูุช ุงูููุชุจุงุช
2. ุดุบูู ููู SQL
3. ุงูุชุญ `/dashboard/etat104`
4. ุงุจุฏุฃ ุงูุงุณุชุฎุฏุงู!

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** ุฃูุชูุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ููุชูู ูุฌุงูุฒ  
**ุงูุชุฑุฎูุต:** ุญุณุจ ุชุฑุฎูุต ุงููุดุฑูุน
