# ๐ ุฏููู ุฅุนุฏุงุฏ ูุธุงู ูุดู 104

## ๐ง **ุงูุฎุทูุฉ 1: ุชุซุจูุช ุงูููุชุจุงุช ุงููุทููุจุฉ**

ูู ุจุชุดุบูู ุงูุฃูุฑ ุงูุชุงูู ูุชุซุจูุช ููุชุจุงุช ุงูุชุตุฏูุฑ:

```bash
npm install xlsx file-saver
npm install --save-dev @types/file-saver
```

ุฃู ุจุงุณุชุฎุฏุงู pnpm:

```bash
pnpm add xlsx file-saver
pnpm add -D @types/file-saver
```

---

## ๐๏ธ **ุงูุฎุทูุฉ 2: ุชุดุบูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**

1. ุงูุชุญ **Supabase SQL Editor**
2. ูู ุจุชุดุบูู ููู: `database/migrations/create_etat104_tables.sql`
3. ุชุฃูุฏ ูู ูุฌุงุญ ุฅูุดุงุก ุงูุฌุฏุงูู ุงูุฃุฑุจุนุฉ:
   - `etat104_declarations`
   - `etat104_clients`
   - `etat104_validations`
   - `etat104_verification_log`

---

## ๐ **ุงูุฎุทูุฉ 3: ุงุณุชุฎุฏุงู ุงููุธุงู**

### **A. ุงูุชุตุฏูุฑ ุฅูู Excel:**

```typescript
import { exportEtat104ToExcel } from '@/utils/etat104ExportUtils';

// ูุซุงู
await exportEtat104ToExcel(
  declaration,    // ุจูุงูุงุช ุงููุดู
  clients,        // ูุงุฆูุฉ ุงูุนููุงุก
  organizationInfo, // ูุนูููุงุช ุงููุคุณุณุฉ
  {
    includeErrors: false,   // ุงุณุชุจุนุงุฏ ุงูุนููุงุก ุจุฃุฎุทุงุก
    includeWarnings: true,  // ุชุถููู ุงูุชุญุฐูุฑุงุช
    language: 'ar'          // ุงููุบุฉ
  }
);
```

### **B. ุชูุฒูู ูููุฐุฌ Excel:**

```typescript
import { exportEtat104Template } from '@/utils/etat104ExportUtils';

// ุชูุฒูู ูููุฐุฌ ูุงุฑุบ
exportEtat104Template();
```

### **C. ุงูุชุญูู ูู NIF ู RC:**

```typescript
import { verifyNIF, verifyRC } from '@/services/etat104Service';

// ุงูุชุญูู ูู NIF
const nifResult = await verifyNIF(
  '123456789012345',
  organizationId,
  clientId  // ุงุฎุชูุงุฑู
);

// ุงูุชุญูู ูู RC
const rcResult = await verifyRC(
  '12345678',
  organizationId,
  clientId  // ุงุฎุชูุงุฑู
);
```

---

## ๐ **ุงูุฎุทูุฉ 4: ุชุฎุตูุต API ููุชุญูู**

### **ุงุณุชุจุฏุงู ุงููุญุงูุงุฉ ุจู API ุญูููู:**

#### **1. ููุชุญูู ูู NIF (DGI):**

ุงูุชุญ ููู: `api/etat104/verify-nif.js`

ุงุณุชุจุฏู ุฏุงูุฉ `simulateNIFVerification` ุจุทูุจ ุญูููู:

```javascript
// ุจุฏูุงู ูู ุงููุญุงูุงุฉ
const response = await fetch('https://dgi.gov.dz/api/verify-nif', {
  method: 'POST',
  headers: { 
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${process.env.DGI_API_KEY}`
  },
  body: JSON.stringify({ nif })
});

const verificationResult = await response.json();
```

#### **2. ููุชุญูู ูู RC (CNRC):**

ุงูุชุญ ููู: `api/etat104/verify-rc.js`

ุงุณุชุจุฏู ุฏุงูุฉ `simulateRCVerification` ุจุทูุจ ุญูููู:

```javascript
// ุจุฏูุงู ูู ุงููุญุงูุงุฉ
const response = await fetch('https://cnrc.dz/api/verify-rc', {
  method: 'POST',
  headers: { 
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${process.env.CNRC_API_KEY}`
  },
  body: JSON.stringify({ rc })
});

const verificationResult = await response.json();
```

---

## ๐ **ุงูุฎุทูุฉ 5: ุฅุถุงูุฉ ููุงุชูุญ API**

ุฃุถู ุงูููุงุชูุญ ุฅูู ููู `.env`:

```env
# ููุงุชูุญ API ููุชุญูู
DGI_API_KEY=your_dgi_api_key_here
CNRC_API_KEY=your_cnrc_api_key_here
```

---

## ๐ฏ **ุงูุฎุทูุฉ 6: ุงุฎุชุจุงุฑ ุงููุธุงู**

1. **ุงูุชุญ ุงูุตูุญุฉ:**
   - ุงูุชูู ุฅูู: `/dashboard/etat104`

2. **ุงุณุชูุฑุฏ ููู Excel:**
   - ุงููุฑ "ุงุณุชูุฑุงุฏ ูู Excel"
   - ุงุฎุชุฑ ููู ุฃู ุงุณุญุจู

3. **ุฑุงุฌุน ุงููุชุงุฆุฌ:**
   - ุดุงูุฏ ุงูุฅุญุตุงุฆูุงุช
   - ุฑุงุฌุน ุงูุฃุฎุทุงุก ูุงูุชุญุฐูุฑุงุช

4. **ุตุฏูุฑ ุงููุดู:**
   - ุงููุฑ "ุชุตุฏูุฑ"
   - ุงุฎุชุฑ Excel ุฃู PDF

---

## ๐ **ุชูุณูู ููู Excel ููุงุณุชูุฑุงุฏ**

ูุฌุจ ุฃู ูุญุชูู ููู Excel ุนูู ุงูุฃุนูุฏุฉ ุงูุชุงููุฉ:

| ุงูุงุณู ุงูุชุฌุงุฑู | NIF | RC | ุฑูู ุงููุงุฏุฉ | ุงูุนููุงู | HT | TVA |
|---------------|-----|----|-----------|---------|----|-----|
| ุดุฑูุฉ ูุซุงู | 123456789012345 | 12345678 | 001 | ุงูุฌุฒุงุฆุฑ | 100000 | 19000 |

**ููุงุญุธุงุช:**
- NIF: 15 ุฑูู ุจุงูุถุจุท
- RC: ุฃุฑูุงู ููุท
- HT: ุงููุจูุบ ูุจู ุงูุถุฑูุจุฉ
- TVA: ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ

---

## โ๏ธ **ููุงุญุธุงุช ูููุฉ**

### **1. ุงูุชุญูู ูู NIF ู RC:**
- ุญุงููุงู ูุณุชุฎุฏู ุงููุธุงู ูุญุงูุงุฉ ููุชุญูู
- ูุฌุจ ุงุณุชุจุฏุงููุง ุจู API ุงููุนูู ูู DGI ู CNRC
- ุงุญูุธ ููุทุงุช ุดุงุดุฉ ููุชุญูู (ูุทููุจ ูุงูููุงู)

### **2. ุงูุชุตุฏูุฑ:**
- ุชูุณูู Excel ูุชูุงูู ูุน DGI
- ูููู ุงุณุชุจุนุงุฏ ุงูุนููุงุก ุจุฃุฎุทุงุก
- ูุชู ุญูุธ ุงูููู ุชููุงุฆูุงู

### **3. ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
- ุฌููุน ุงูุจูุงูุงุช ูุญููุฉ ุจู RLS
- ุงูุฅุญุตุงุฆูุงุช ุชูุญุฏุซ ุชููุงุฆูุงู
- ุณุฌู ูุงูู ููุชุญูู

---

## ๐ **ุงุณุชูุดุงู ุงูุฃุฎุทุงุก**

### **ุฎุทุฃ: "xlsx is not defined"**
```bash
npm install xlsx file-saver
```

### **ุฎุทุฃ: "Table does not exist"**
ูู ุจุชุดุบูู ููู SQL ูู Supabase

### **ุฎุทุฃ: "Permission denied"**
ุชุฃูุฏ ูู ุชูุนูู RLS ูุฅุนุฏุงุฏ ุงูุณูุงุณุงุช

---

## ๐ **ุงูุฏุนู**

ูููุฒูุฏ ูู ุงููุณุงุนุฏุฉ:
1. ุฑุงุฌุน ุงูุฐุงูุฑุฉ ุงููุญููุธุฉ ูููุธุงู
2. ุชุญูู ูู ูููุงุช ุงูุชูุซูู
3. ุฑุงุฌุน ุงูููุฏ ุงููุตุฏุฑู

---

## โ **ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ**

- [ ] ุชุซุจูุช ุงูููุชุจุงุช (xlsx, file-saver)
- [ ] ุชุดุบูู ููู SQL ูู Supabase
- [ ] ุฅุถุงูุฉ ููุงุชูุญ API (ุงุฎุชูุงุฑู)
- [ ] ุงุฎุชุจุงุฑ ุงูุงุณุชูุฑุงุฏ
- [ ] ุงุฎุชุจุงุฑ ุงูุชุตุฏูุฑ
- [ ] ุงุฎุชุจุงุฑ ุงูุชุญูู ูู NIF/RC
- [ ] ูุฑุงุฌุนุฉ ุงูุฅุญุตุงุฆูุงุช

---

**๐ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู!**
