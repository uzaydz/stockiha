# تحديث نظام الاشتراكات - دعم الأسعار المتعددة

## نظرة عامة
تم تطوير نظام الاشتراكات ليدعم أسعار ومدد متعددة لكل خدمة اشتراك، مما يوفر مرونة أكبر في التسعير والعروض.

## التحديثات المطبقة

### 1. قاعدة البيانات
#### جداول جديدة:
- `subscription_service_pricing` - أسعار ومدد الاشتراكات
- `subscription_pricing_history` - تاريخ تغييرات الأسعار
- `subscription_coupons` - كوبونات وخصومات الاشتراكات
- `subscription_reviews` - تقييمات العملاء

#### ميزات الجدول الرئيسي:
- **أسعار متعددة**: كل خدمة يمكن أن تحتوي على عدة خيارات أسعار
- **مدد مختلفة**: شهر، 3 أشهر، سنة، إلخ
- **خصومات**: نسب خصم لكل خيار سعر
- **نصوص ترويجية**: "الأكثر شعبية"، "أفضل قيمة"
- **أيام إضافية مجانية**: bonus_days
- **ميزات خاصة**: features و limitations
- **إدارة المخزون**: كمية منفصلة لكل خيار سعر

### 2. الواجهة الأمامية

#### صفحة إدارة الاشتراكات (`SubscriptionServices.tsx`):
- **تصميم محسن**: عرض شبكي وجدولي
- **إدارة أسعار متقدمة**: إضافة/تعديل/حذف خيارات الأسعار
- **إحصائيات شاملة**: إيرادات وأرباح من جميع خيارات الأسعار
- **فلترة متقدمة**: حسب الفئة والحالة
- **نافذة إدارة الأسعار**: عرض وتعديل جميع خيارات الأسعار

#### كتالوج الاشتراكات (`SubscriptionCatalog.tsx`):
- **عرض نطاق الأسعار**: من أقل إلى أعلى سعر
- **نافذة اختيار الخطة**: عرض جميع خيارات الأسعار مع التفاصيل
- **شارات الخصم**: عرض نسب الخصم والعروض
- **شارات مميزة**: للخطط المميزة
- **حساب السعر الشهري**: عرض التكلفة الشهرية لكل خطة

#### سلة التسوق (`CartSubscription.tsx`):
- **عرض تفاصيل الخطة**: المدة والسعر النهائي
- **عرض الخصومات**: نسبة الوفر
- **كود التتبع**: لكل اشتراك
- **تعديل الأسعار**: إمكانية تعديل السعر يدوياً

#### نقطة البيع (`POS.tsx`):
- **جلب الأسعار المتعددة**: تحميل جميع خيارات الأسعار
- **إدارة السلة المحسنة**: دعم الاشتراكات مع أسعار متعددة
- **معرفات فريدة**: cart_id لتمييز نفس الخدمة بأسعار مختلفة

## الميزات الجديدة

### 1. أسعار متدرجة
- **شهر واحد**: السعر القياسي
- **3 أشهر**: خصم 5-10%
- **سنة كاملة**: خصم 15-20%
- **خطط مخصصة**: مدد وأسعار حسب الطلب

### 2. نظام الخصومات
- **خصومات نسبية**: نسبة مئوية من السعر الأصلي
- **أيام إضافية**: bonus_days مجانية
- **نصوص ترويجية**: رسائل تسويقية مخصصة

### 3. إدارة المخزون المتقدمة
- **مخزون منفصل**: لكل خيار سعر
- **تتبع المبيعات**: إحصائيات مفصلة لكل خطة
- **تحديث تلقائي**: للكميات المتاحة

### 4. تجربة مستخدم محسنة
- **مقارنة الخطط**: عرض جميع الخيارات جنباً إلى جنب
- **توضيح الوفر**: عرض المبلغ الموفر لكل خطة
- **تصميم متجاوب**: يعمل على جميع الأجهزة

## البيانات التجريبية
تم إنشاء بيانات تجريبية تلقائياً للخدمات الموجودة:
- **شهر واحد**: السعر الأصلي (افتراضي)
- **3 أشهر**: خصم 5% + "وفر 5%"
- **سنة كاملة**: خصم 15% + "أفضل قيمة - وفر 15%" (مميز)

## التوافق مع النظام القديم
- **دعم البيانات القديمة**: النظام يعمل مع الخدمات الموجودة
- **تحويل تلقائي**: إنشاء أسعار افتراضية للخدمات القديمة
- **واجهة موحدة**: نفس الواجهة تدعم النظامين

## الأمان والصلاحيات
- **Row Level Security**: حماية البيانات حسب المؤسسة
- **تشفير البيانات**: حماية معلومات الاشتراكات الحساسة
- **تدقيق التغييرات**: تسجيل جميع تعديلات الأسعار

## الاستخدام

### إضافة خدمة جديدة:
1. انتقل إلى صفحة "خدمات الاشتراكات"
2. اضغط "إضافة خدمة جديدة"
3. املأ المعلومات الأساسية
4. انتقل لتبويب "الأسعار والمدد"
5. أضف خيارات الأسعار المختلفة
6. حدد السعر الافتراضي والمميز

### في نقطة البيع:
1. انتقل لتبويب "الاشتراكات"
2. اختر الخدمة المطلوبة
3. إذا كان لها أسعار متعددة، ستظهر نافذة الاختيار
4. اختر الخطة المناسبة
5. ستضاف للسلة مع تفاصيل الخطة

## الإحصائيات والتقارير
- **إيرادات شاملة**: من جميع خيارات الأسعار
- **أداء الخطط**: أكثر الخطط مبيعاً
- **معدل التحويل**: نسبة اختيار كل خطة
- **الأرباح المفصلة**: ربح كل خطة منفصلة

## المتطلبات التقنية
- **PostgreSQL**: قاعدة بيانات محدثة
- **Supabase**: نظام المصادقة والصلاحيات
- **React**: واجهة المستخدم
- **TypeScript**: للأمان والوضوح

## الصيانة والتطوير المستقبلي
- **إضافة كوبونات الخصم**: نظام كوبونات متقدم
- **تقييمات العملاء**: نظام تقييم الخدمات
- **تقارير متقدمة**: تحليلات مفصلة للمبيعات
- **API للتكامل**: ربط مع أنظمة خارجية

---

**تاريخ التحديث**: ديسمبر 2024  
**الإصدار**: 2.0  
**المطور**: فريق تطوير بازار 