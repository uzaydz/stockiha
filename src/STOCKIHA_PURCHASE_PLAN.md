# ๐ ุฎุทุฉ ุชูููุฐ ูุธุงู ุงููุดุชุฑูุงุช ุงููุชุทูุฑ (Stockiha Rival)

ุจูุงุกู ุนูู ุชุญููู ุงููููุงุช ููุชุทูุจุงุชู ูุจูุงุก ูุธุงู ููุงูุณ ูู "ุณุทููููุง"ุ ูุฐู ูู ุงูุฎุทุฉ ุงูุชูุตูููุฉ ูุชุญููู ุตูุญุฉ ุงููุดุชุฑูุงุช ุฅูู ูุธุงู ERP ูุตุบุฑ ูุฐูู.

## ๐ฏ ุงูุฃูุฏุงู ุงูุฃุณุงุณูุฉ
1.  **ูุนุงูุฌุฉ ุงููุญุฏุงุช ุงููุนูุฏุฉ:** (ูุชุฑุ ููููุ ููุฉุ ูุฑุชููุฉ) ุจูุฑููุฉ ุชุงูุฉ.
2.  **ุฅุฏุฎุงู ุงูุฃุตูุงู (Variants):** ูุตูููุฉ ุณุฑูุนุฉ ููุฃููุงู ูุงูููุงุณุงุช.
3.  **ุงูุชุณุนูุฑ ุงูุฐูู:** ุงูุชุฑุงุญ ุฃุณุนุงุฑ ุงูุจูุน ุจูุงุกู ุนูู ุชุบูุฑ ุงูุชูููุฉ + ุชูุฒูุน ุงููุตุงุฑูู ุงูุฅุถุงููุฉ.
4.  **ูุงุฌูุฉ ูุงุฆูุฉ ุงูุณุฑุนุฉ (Turbo Mode):** ูููุญุชุฑููู.

---

## 1. ููููุฉ ุงูุจูุงูุงุช (Data Architecture) ๐๏ธ

ูุฌุจ ุชุญุฏูุซ ุฃู ุงูุชุฃูุฏ ูู ุฃู ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุฏุนู "ุชุนุฏุฏ ุงููุญุฏุงุช".
ุญุงููุงู ูุฏูู ุญููู ูุซู `sell_by_meter` ู `sell_by_weight`. ุณูููู ุจุชูุญูุฏ ุงูููุทู ุจุฑูุฌูุงู ูู ุงููุงุฌูุฉุ ูููู ููุถู ุฅุถุงูุฉ ุญูู `purchase_config` ูู ุฌุฏูู `products` ุฃู ุงูุชุนุงูู ูุนู ุนุจุฑ `advancedSettings`.

### ููููู "ุงููุญุฏุฉ ุงูุฃุณุงุณูุฉ" (The Golden Rule)
*   **ุงููุฎุฒูู (Inventory)**: ููุญูุธ ุฏุงุฆูุงู ุจู `Base Unit` (ุงููุทุนุฉุ ุงููุชุฑุ ุงูุฌุฑุงู).
*   **ุงูุดุฑุงุก (Purchase)**: ูุชู ุจู `Purchase Unit` (ูุฑุชููุฉุ ููุฉุ ุดูุงู).
*   **ุงูุชุญููู**: `Quantity = PurchaseQty * ConversionFactor`.

---

## 2. ูุงุฌูุฉ ุงููุณุชุฎุฏู (The Smart UI) ๐จ

ุณูููู ุจุจูุงุก ุตูุญุฉ ุฌุฏูุฏุฉ ูููุงู: `src/pages/admin/purchases/SmartPurchasePage.tsx`.

### ุฃ. ุฑุฃุณ ุงููุงุชูุฑุฉ (Smart Header)
*   **ุงูููุฑุฏ:** `SmartSupplierSelect` (ุจุญุซ ุจุงูุงุณู/ุงููุงุชู).
*   **ุงููุฎุฒู:** ุงุฎุชูุงุฑ ุงููุฑุน ุงููุณุชูู.
*   **Turbo Mode Switch:** โก ุฒุฑ ุชูุนูู "ูุถุน ุงูุณุฑุนุฉ" (ุฅุฎูุงุก ุงูุชูุงุตูู ุบูุฑ ุงูุถุฑูุฑูุฉุ ุงูุชููู ุจุงูู Enter).

### ุจ. ุงูุดุจูุฉ ุงูุฐููุฉ (The Smart Grid) ๐
ุณูุณุชุฎุฏู ุฌุฏููุงู ุฏููุงููููุงู (Dynamic Table) ุจููุฒุงุช ูุชูุฏูุฉ:

| ุงููููู | ุงููุตู | ุงูููุทู ุงูุฐูู |
| :--- | :--- | :--- |
| **Product & Variant** | ุจุญุซ ูุฏูุฌ + ุฒุฑ "Matrix" | ุนูุฏ ุงุฎุชูุงุฑ ููุชุฌ ูู ูุชุบูุฑุงุชุ ุชูุชุญ ูุงูุฐุฉ ุงููุตูููุฉ ุชููุงุฆูุงู ุฃู ูุธูุฑ ุฒุฑ โฆ. |
| **Unit Selector** | ูุงุฆูุฉ (ูุทุนุฉ / ูุฑุชููุฉ) | ุชุนุฑุถ ุนุงูู ุงูุชุญููู ุจุฎุท ุจุงูุช (ร12). ุนูุฏ ุงูุชุบููุฑุ ูุชุญุฏุซ ุงูุณุนุฑ ุงูููุชุฑุญ. |
| **Qty & Stock** | ุฅุฏุฎุงู ุงููููุฉ | ูุธูุฑ ุงููุฎุฒูู ุงูุญุงูู ุจุฌุงูุจูุง ุจุฐูุงุก: `500m (5 Rolls)`. |
| **Costs** | ุชูููุฉ ุงููุญุฏุฉ | ูุญุณุจ ุชููุงุฆูุงู `Base Cost` (ูููุฑุงุกุฉ ููุท) ูุชุชุฃูุฏ ูู ุณุนุฑ ุงููุชุฑ ุงููุงุญุฏ. |
| **Dynamic Pricing** | ุณุนุฑ ุงูุจูุน ุงูุฌุฏูุฏ | **ืืูุฒุฉ ุงููุงุชูุฉ:** ุฅุฐุง ุฒุงุฏุช ุงูุชูููุฉ 10%ุ ููุชุฑุญ ุงููุธุงู ุณุนุฑุงู ุฌุฏูุฏุงู ูุญูุธ ููุณ ูุงูุด ุงูุฑุจุญ ุงููุฏูู. |
| **Expiry** | ุชุงุฑูุฎ ุงูุตูุงุญูุฉ | ูุธูุฑ ููุท ููููุชุฌุงุช ุงูุชู ุชุชุทูุจ ุฐูู (`is_perishable`). |

### ุฌ. ูุตูููุฉ ุงููุชุบูุฑุงุช (Variant Matrix Popup) โฆ
ุจุฏูุงู ูู ุฅุถุงูุฉ 50 ุณุทุฑ ููููุตุงู:
*   ูุงูุฐุฉ ููุจุซูุฉ ุชุธูุฑ ุนูุฏ ุงุฎุชูุงุฑ "ูููุต ุตููู".
*   **ุงูุฃุนูุฏุฉ:** S, M, L, XL.
*   **ุงูุตููู:** ุฃุญูุฑุ ุฃุฒุฑูุ ุฃุจูุถ.
*   ูููู ุงูุชุงุฌุฑ ุจููุก ุงูุฃุฑูุงู ุจุณุฑุนุฉ (5, 5, 2, 0).
*   ุฒุฑ **"Confirm"** ูุถูู 3 ุฃุณุทุฑ ููุท ูููุงุชูุฑุฉ (ุฃุญูุฑ Sุ ุฃุญูุฑ Mุ ุฃุญูุฑ L) ุฃู ุณุทุฑ ูุงุญุฏ ูุฌูุน (ุญุณุจ ุงูุฅุนุฏุงุฏุงุช).

### ุฏ. ุชูุฒูุน ุงูุชูุงููู (Landed Costs) ๐ฐ
ุฒุฑ ูู ุงูุฃุณูู "ูุตุงุฑูู ุฅุถุงููุฉ":
*   ููู: 5000 ุฏุฌ.
*   ุฌูุงุฑู: 20000 ุฏุฌ.
*   **ุงูุชูุฒูุน:** ูููู ุงููุธุงู ุจุชูุฒูุน 25000 ุฏุฌ ุนูู ุงูููุชุฌุงุช ุจูุงุกู ุนูู (ูููุชูุง) ุฃู (ูุฒููุง) ููุนุทูู **ุงูุชูููุฉ ุงูุญููููุฉ (Real Cost)** ููู ูุทุนุฉ.

---

## 3. ุงูููุทู ุงูุจุฑูุฌู (Core Logic Hooks) ๐ง

ุณููุดุฆ Hooks ูุฎุตุตุฉ ููุฐุง ุงููุธุงู:

1.  `useUnitConversion(product, unit)`:
    *   ูุนูุฏ `conversionFactor` (ูุซูุงู ุงููุฑุชููุฉ = 12).
    *   ูุนูุฏ `baseCost` (ุณุนุฑ ุงููุฑุชููุฉ / 12).

2.  `useSmartPricing(oldCost, newCost, currentSellPrice, margin)`:
    *   ูุฑุงูุจ ุชุบูุฑ `newCost`.
    *   ุฅุฐุง ุชุบูุฑุ ูุญุณุจ: `SuggestedPrice = NewCost * (1 + Margin)`.
    *   ูุฑุฌุน ุชูุจููุงู `priceAlert: true` ุฅุฐุง ูุงู ุงูุงุฑุชูุงุน ูุจูุฑุงู.

3.  `useLandedCostDistributor(items, extraCosts)`:
    *   ูุนูุฏ ุชูุฒูุน ุงูุชูุงููู ุงูุฅุถุงููุฉ ุนูู ูู ุนูุตุฑ ูุชุญุฏูุซ `finalCost`.

---

## 4. ุฎุทูุงุช ุงูุชูููุฐ (Implementation Steps) ๐

### ุงููุฑุญูุฉ 1: ุงูุชุฃุณูุณ (Foundation)
1.  ุฅูุดุงุก ุงููุฌูุฏุงุช: `src/features/purchases/`.
2.  ุจูุงุก ุงูุฃููุงุน `types/smart-purchase.ts` (ูุชุบุทูุฉ ุงููุญุฏุงุช ูุงูุชุญูููุงุช).

### ุงููุฑุญูุฉ 2: ุงูููููุงุช ุงูุฐููุฉ (Smart Components)
3.  ุจูุงุก `UnitSelector`: ูููู ูุนุฑุถ ุงููุญุฏุงุช ุงููุชุงุญุฉ ููููุชุฌ (ูุชุฑ/ููุฉ).
4.  ุจูุงุก `VariantMatrix`: ูุงูุฐุฉ ุฅุฏุฎุงู ุงููููุงุช ูููุชุบูุฑุงุช.
5.  ุจูุงุก `SmartPurchaseRow`: ุณุทุฑ ุงูุฌุฏูู ุงูุฐู ูุญุชูู ุนูู ููุทู ุงูุญุณุงุจุงุช.

### ุงููุฑุญูุฉ 3: ุตูุญุฉ ุงููุดุชุฑูุงุช (The Page)
6.  ุชุทููุฑ ุตูุญุฉ `SmartPurchasePage.tsx` ูุฑุจุท ุงูููููุงุช.
7.  ุชุทุจูู "Turbo Mode" (ุงูุชุฑููุฒ ุงูุชููุงุฆู ูุงุฎุชุตุงุฑุงุช ููุญุฉ ุงูููุงุชูุญ).

### ุงููุฑุญูุฉ 4: ุงูุฐูุงุก (Intelligence)
8.  ุฑุจุท `useSmartPricing` ูุงูุชุฑุงุญ ุงูุฃุณุนุงุฑ.
9.  ุชูููุฐ ููุทู "ุชุฎุฒูู ุงููุฎุฒูู" (ุชุญููู ุงููุญุฏุงุช ุงููุดุชุฑุงุฉ ุฅูู ูุญุฏุงุช ุฃุณุงุณูุฉ ูุญูุธูุง ูู DB).

---

ูุฐู ุงูุฎุทุฉ ุชุญูู ูุธุงูู ูู ูุฌุฑุฏ ูุณุฌู ุจูุงูุงุช ุฅูู **ูุณุงุนุฏ ุฐูู ููุชุงุฌุฑ**ุ ููู ูุง ุณูููุฒู ุนู ุงูููุงูุณูู. ูู ูุจุฏุฃ ุจุงูุชูููุฐุ
