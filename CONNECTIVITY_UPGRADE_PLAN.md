# ุชุญููู ูุธุงู ุงูุงุชุตุงู ู ุฎุทุฉ ุงูุชุทููุฑ (Connectivity System Upgrade Plan)

ุจูุงุกู ุนูู ุชุญููู ุงูุณุฌูุงุช (Logs) ูุงูููุฏ ุงูุญุงููุ ููุช ุจุชุญุฏูุฏ ุงููุดุงูู ุจุฏูุฉ ููุถุนุช ุฎุทุฉ ุดุงููุฉ ูุชุทููุฑ ูุธุงู ุชุญูู ูู ุงูุฅูุชุฑูุช ูููู "ูุซุงููุงู" ููุจูุฆุฉ ุงูุฌุฒุงุฆุฑูุฉ (ุดุจูุฉ ุบูุฑ ูุณุชูุฑุฉ).

## 1. ุชุญููู ุงููุดุงูู ุงูุญุงููุฉ (Diagnosis)

ูู ุฎูุงู ูุฑุงุฌุนุฉ `ConnectivityService.ts` ูุงูุณุฌูุงุช:

### ุฃ. ูุดููุฉ "ุงูุชุฑุฏุฏ" (Flapping)
ุงูุณุฌูุงุช ุชุธูุฑ ุฃู ุงูุญุงูุฉ ุชุชุบูุฑ ุจุณุฑุนุฉ ุฌููููุฉ:
```
ConnectivityService.ts:528 ๐ด Status changed: ONLINE โ OFFLINE
ConnectivityService.ts:528 ๐ข Status changed: OFFLINE โ ONLINE
```
**ุงูุณุจุจ:** ุงููุธุงู ุงูุญุงูู ูุบูุฑ ุงูุญุงูุฉ ุฅูู `OFFLINE` **ููุฑุงู** ุนูุฏ ูุดู ุทูุจ ูุงุญุฏ (`quickCheck`) ุฃู ุนูุฏ ุงุณุชูุงู ุญุฏุซ ุงููุชุตูุญ. ูู ุงูุฌุฒุงุฆุฑุ ุงููุทุงุน ุงุชุตุงู ูููู-ุซุงููุฉ ุฃู ูุดู DNS ุนุงุจุฑ ูู ุฃูุฑ ุทุจูุนู ููุง ูุนูู ุงููุทุงุน ุงูุฅูุชุฑูุช ุจุงููุงูู.

### ุจ. ุงูุงุนุชูุงุฏ ุนูู ููุทุฉ ูุดู ูุงุญุฏุฉ (Single Point of Failure)
ุงูููุฏ ูุนุชูุฏ ุจุดูู ูุจูุฑ ุนูู `https://www.google.com/generate_204` ูู ุฏุงูุฉ `quickCheck`.
**ุงููุดููุฉ:** ุงูุฎุทุฃ `net::ERR_CONNECTION_CLOSED` ุงูุฐู ูุธูุฑ ูู ุงูุณุฌูุงุช ูุนูู ุฃู ุงูุงุชุตุงู ุจุณูุฑูุฑ ุฌูุฌู ููุทุนุ ูููู ูุฐุง ูุง ูุนูู ุจุงูุถุฑูุฑุฉ ุฃู ุงูุฅูุชุฑูุช ููุทูุน (ูุฏ ูููู ุญุธุฑ ูุคูุชุ ุจุทุก DNSุ ุฃู ูุดููุฉ ูู ุชูุฌูู ุงูุจูุงูุงุช ูุฐูู ุงูุณูุฑูุฑ ุจุงูุชุญุฏูุฏ).

### ุฌ. ุนุฏู ุงูุงุณุชูุงุฏุฉ ูู "ุงููุฑูุฑ ุงูุณูุจู" (Passive Monitoring)
ุงููุธุงู ูุนุชูุฏ ูููุงู ุนูู ุงูู "Active Pings" (ุฅุฑุณุงู ุทูุจุงุช ููุชุญูู).
**ุงููุดููุฉ:** ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุชุตูุญ ุงูุชุทุจูู ููุฌูุจ ุงูุจูุงูุงุช ุจูุฌุงุญ ูู Supabaseุ ููู ุงูุฎุทุฃ ุฃู ูุฎุจุฑู "ุฃูุช ุฃูููุงูู" ููุท ูุฃู `ping` ุฌูุฌู ูุดู! ูุฌุงุญ ุทูุจุงุช ุงูุชุทุจูู ูู ุฃุตุฏู ุฏููู ุนูู ูุฌูุฏ ุงูุฅูุชุฑูุช.

---

## 2. ุงูุฎุทุฉ ุงูููุชุฑุญุฉ: "ุงูุฏุฑุน ุงูุฌุฒุงุฆุฑู" (The Algeria Shield Architecture)

ุณูููู ุจุฅุนุงุฏุฉ ุจูุงุก ููุทู ุงูุชุญูู ููููู "ุฏูุงุนูุงู" ูุตุชูุฏุงู ููุตุฏูุงุช.

### ุงููุจุฏุฃ ุงูุฃุณุงุณู: Status Confidence (ุฏุฑุฌุฉ ุงูุซูุฉ) ุจุฏูุงู ูู (ูุนู/ูุง)
ุจุฏูุงู ูู `Online/Offline` ูุจุงุดุฑุฉุ ุณูุนุชูุฏ ูุธุงู ุงูููุงุท ุฃู "ูุฎุฒู ูุคูุช ููุฃุฎุทุงุก" (Error Budget).

### ุงูุฎูุงุฑุฒููุฉ ุงูุฌุฏูุฏุฉ ุงูููุชุฑุญุฉ:

#### 1. ูุธุงู ุงูุชุญูู ุงููุชุนุฏุฏ (Multi-Provider Verification)
ุจุฏูุงู ูู ุงูุชุณุงุจู (Race) ุงูุฐู ูููุฒ ููู ุงูุฃุณุฑุนุ ุณูุณุชุฎุฏู ููุทู **Failover**.
*   **ุงููุญุงููุฉ 1:** `Ping Google` (ุณุฑูุน).
*   **ุฅุฐุง ูุดู:** ูุง ูุนูู Offline ููุฑุงู.
*   **ุงููุญุงููุฉ 2 (ููุฑูุฉ):** `Ping Cloudflare` (1.1.1.1) ุฃู `Microsoft`.
*   **ุฅุฐุง ูุดู:** ุงูุชุธุฑ 500ms.
*   **ุงููุญุงููุฉ 3:** `Ping Supabase` (ููุณ ุณูุฑูุฑ ุงูุฏุงุชุง).
*   **ููุท ุฅุฐุง ูุดู ุงูุฌููุน:** ูุนูู `Potential Offline`.

#### 2. ูุฎุฒู ุงูุงุณุชูุฑุงุฑ (Stability Buffer / Hysteresis)
*   ุนูุฏ ุงูุชุดุงู ุงููุทุงุน (Offline)ุ ูุง ูุบูุฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู ุฅูุง ุจุนุฏ **3 ุชุนุซุฑุงุช ูุชุชุงููุฉ** (Three Strikes Rule) ุฎูุงู ูุฏุฉ ุฒูููุฉ ูุตูุฑุฉ.
*   ูุฐุง ูููุน ุงูุชูุจููุงุช ุงููุฒุนุฌุฉ "ุชู ุงุณุชุนุงุฏุฉ ุงูุงุชุตุงู" -> "ุงููุทุน ุงูุงุชุตุงู" ูู ุซุงููุฉ.

#### 3. ุงููุฑุงูุจุฉ ุงูุณูุจูุฉ (Passive Listener)
*   ุณูุถูู ุฏุงูุฉ `reportActivity(success: boolean)` ูุชู ุงุณุชุฏุนุงุคูุง ูู `SupabaseClient` ุฃู ุฃู ููุงู ูุญุฏุซ ููู `fetch`.
*   **ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ:** ุฅุฐุง ูุฌุญ ุฃู ุทูุจ ุจูุงูุงุช ุญูููู (Business Logic)ุ ูุฅู ุงูุญุงูุฉ ุชูุฌุจุฑ ููุฑุงู ุนูู **ONLINE** ููุชู ุชุตููุฑ ุนุฏุงุฏ ุงูุฃุฎุทุงุกุ ุญุชู ูู ูุดู ุงูู Ping. "ุงููุงูุน ูุบูุจ ุงูุงุฎุชุจุงุฑ".

#### 4. ุชุญุณูู ููุงุณ ุงูุฌูุฏุฉ (Network Quality)
*   ุจุฏูุงู ูู ูุฌุฑุฏ `Good/Bad`ุ ุณูููุณ "ุงูุชูุทุน" (Jitter).
*   ุฅุฐุง ูุงู ุงูุงุชุตุงู ููุฌูุฏุงู ูููู ููุดู 50% ูู ุงูููุชุ ุงูุญุงูุฉ ุชููู **"Unstable" (ุบูุฑ ูุณุชูุฑ)** ุจุฏูุงู ูู Offline. ูุฐุง ูุณูุญ ููุชุทุจูู ุจุงูุนูู (ูุซู ุญูุธ ุงูุจูุงูุงุช ูุญููุงู Sync Queue) ุฏูู ููุน ุงููุณุชุฎุฏู ูู ุงูุนูู.

---

## 3. ุฎุทูุงุช ุงูุชูููุฐ (Action Plan)

ุณูููู ุจุงูุชุนุฏูู ุนูู ุงููููุงุช ุงูุชุงููุฉ ุจุญุฐุฑ:

1.  **ุชุนุฏูู `ConnectivityTypes.ts`**:
    *   ุฅุถุงูุฉ ุญุงูุงุช ุฌุฏูุฏุฉ: `UNSTABLE`.
    *   ุฅุถุงูุฉ ุฅุนุฏุงุฏุงุช `failureThreshold` (ุญุฏ ุงููุดู ูุจู ุงุนุชุจุงุฑ ุงูุฃูููุงูู).

2.  **ุชุญุฏูุซ `MultiEndpointPing.ts`**:
    *   ุฅุฒุงูุฉ ุงูุงุนุชูุงุฏ ุงูููู ุนูู `Promise.any` ูู ุงููุญุต ุงูุณุฑูุน.
    *   ุฅุถุงูุฉ ูุตูููุฉ `FALLBACK_ENDPOINTS` (Cloudflare, Mozilla, etc.).
    *   ูุชุงุจุฉ ุฏุงูุฉ `smartCheck()` ุชููู ุจุงูุชุฌุฑุจุฉ ุงูุชุณูุณููุฉ ุงูุณุฑูุนุฉ (Sequential Failover).

3.  **ุฅุนุงุฏุฉ ูุชุงุจุฉ `ConnectivityService.ts`**:
    *   ุฅุถุงูุฉ ูุชุบูุฑ `failureStreak` (ุณูุณูุฉ ุงููุดู).
    *   ุชุนุฏูู `updateState`: ุงูุชุญูู ูู Offline ูุชุทูุจ `failureStreak >= 3`.
    *   ุฅุถุงูุฉ ููุซูุฏ `reportSuccessfulRequest()` ูุฑุจุทูุง ูุน ุจุงูู ุงูุชุทุจูู ูุงุญูุงู.

ูุฐุง ุงููุธุงู ุณูุถูู ุฃู ุงูุชุทุจูู ูุง ูุธูุฑ "Offline" ุฅูุง ุฅุฐุง ุงููุทุนุช ุงูุฅูุชุฑูุช ูุนููุงู ุนู ูู ุงููุตุงุฏุฑุ ููุชุญูู ุชุฐุจุฐุจ ุงูุดุจูุฉ ูู ุงูุฌุฒุงุฆุฑ.
