# إصلاح خطأ "invalid input syntax for type integer: "default""

## المشكلة

هناك خطأ عند إنشاء منتج جديد يظهر الرسالة التالية:

```
invalid input syntax for type integer: "default"
```

هذا يحدث لأن قيمة "default" يتم إرسالها إلى عمود `shipping_clone_id` الذي يتوقع قيمة رقمية.

## الحلول

تم توفير عدة حلول في هذا المشروع:

### 1. في الواجهة الأمامية

- في ملف `src/lib/api/products.ts`: تم تعديل دالة `createProduct` للتعامل مع القيم النصية وتحويلها إلى `null`
- في ملف `src/pages/ProductForm.tsx`: تم إزالة حقل `shipping_clone_id` تماماً من كائن البيانات المرسل
- في ملف `src/components/product/ProductShippingSelector.tsx`: تم تحسين دالة `handleChange` للتعامل مع القيم "default" و"default_provider"

### 2. في قاعدة البيانات

هناك ملفين SQL جاهزين للتنفيذ في لوحة تحكم Supabase:

1. **fix_shipping_clone_id_urgent.sql**: يحذف ال triggers المسببة للمشكلة ويضيف trigger جديد آمن.
2. **fix_shipping_clone_id_db_trigger.sql**: حل أكثر شمولية يعالج المشكلة من جذورها.

## خطوات التنفيذ

1. **قم بتطبيق التعديلات البرمجية**:
   - تحديث ملف products.ts
   - تحديث ProductForm.tsx
   - تحديث ProductShippingSelector.tsx

2. **قم بتنفيذ أحد ملفات SQL**:
   - افتح لوحة تحكم Supabase للمشروع
   - انتقل إلى أداة SQL
   - نسخ محتوى أحد ملفات SQL وتنفيذه

3. **اختبار**:
   - بعد تطبيق التغييرات، قم بإنشاء منتج جديد للتأكد من عدم ظهور الخطأ

## القيم المرفوضة

القيم التالية سيتم تحويلها تلقائياً إلى `null`:
- "default"
- "default_provider"
- "1" (كنص)
- "0" (كنص)
- 1 (كرقم إذا كان يستخدم كقيمة افتراضية)
- 0 (كرقم إذا كان يستخدم كقيمة افتراضية)
- أي قيمة نصية لا يمكن تحويلها إلى رقم

## ملاحظات هامة

- تأكد من تنفيذ ملفات SQL على قاعدة بيانات الإنتاج وليس فقط على بيئة التطوير
- هذا الإصلاح مهم للسماح بإضافة منتجات جديدة بدون خطأ
- قد تحتاج أيضاً لإصلاح النماذج الأخرى التي تستخدم shipping_clone_id

## للمزيد من المساعدة

إذا استمرت المشكلة، تحقق من سجلات الخادم وسجلات الأخطاء في supabase لمعرفة المزيد من التفاصيل. 