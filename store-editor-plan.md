# خطة تطوير نظام تحرير متجر بخاصية السحب والإفلات

## تحليل مكونات صفحة المتجر الحالية

بعد تحليل صفحة المتجر، تبين أنها تتكون من المكونات الرئيسية التالية:

1. **الهيرو (StoreBanner)**:
   - صورة رئيسية
   - عنوان رئيسي
   - وصف
   - أزرار دعوة للعمل
   - شارات الثقة (توصيل سريع، دفع آمن، جودة عالية)

2. **تصفح فئات منتجاتنا (ProductCategories)**:
   - فئات المنتجات مع صور وأسماء ووصف
   - عدد المنتجات في كل فئة
   - تصميم بطاقات الفئات

3. **منتجاتنا المميزة (FeaturedProducts)**:
   - قائمة بالمنتجات المميزة
   - خيارات عرض (شبكة أو قائمة)
   - إمكانية إضافة للمفضلة أو عربة التسوق
   - معلومات العروض والخصومات

4. **آراء عملائنا (CustomerTestimonials)**:
   - تقييمات العملاء
   - صور العملاء
   - تقييم بالنجوم
   - اسم المنتج المشتري

5. **عن متجرنا (StoreAbout)**:
   - عنوان القسم
   - وصف نص طويل
   - إحصائيات متجر (سنة التأسيس، عدد العملاء، عدد المنتجات، عدد الفروع)
   - مميزات المتجر
   - صورة توضيحية

## خطة التنفيذ

سنقوم بتنفيذ نظام تحرير متجر يتيح لصاحب المتجر تخصيص كل مكون من مكونات الصفحة باستخدام واجهة سحب وإفلات. سنبدأ بمكون الهيرو (StoreBanner) كمرحلة أولى.

### المرحلة الأولى - مكون تحرير الهيرو

1. **إنشاء واجهة المستخدم للتحرير**:
   - إنشاء صفحة `StoreEditor.tsx` في مجلد `src/pages/admin`
   - تطوير مكون `HeroEditor.tsx` في مجلد `src/components/store-editor`
   - استخدام مكتبة dnd-kit لتوفير خاصية السحب والإفلات

2. **هيكل البيانات المطلوب**:
   - إنشاء جدول `store_settings` في قاعدة البيانات لتخزين إعدادات المتجر:
     ```sql
     CREATE TABLE store_settings (
       id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
       organization_id UUID NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
       component_type TEXT NOT NULL, -- 'hero', 'categories', 'featured_products', 'testimonials', 'about'
       settings JSONB NOT NULL,
       is_active BOOLEAN DEFAULT true,
       order_index INTEGER DEFAULT 0,
       created_at TIMESTAMPTZ DEFAULT NOW(),
       updated_at TIMESTAMPTZ DEFAULT NOW()
     );
     ```

3. **واجهة التحرير للهيرو**:
   - حقول لتعديل العنوان الرئيسي
   - حقل لتعديل الوصف
   - حقول لتعديل نص وروابط الأزرار
   - رفع صورة الهيرو
   - إضافة/حذف/تعديل شارات الثقة

4. **نظام المعاينة المباشرة**:
   - عرض معاينة مباشرة للتغييرات قبل الحفظ
   - عرض المكون بشكل مشابه للواجهة النهائية

5. **نظام حفظ الإعدادات**:
   - أزرار لحفظ التغييرات أو إلغائها
   - معالج API لحفظ الإعدادات في قاعدة البيانات
   - تحديث فوري للواجهة عند الحفظ

### مخطط قاعدة البيانات للإعدادات

لتمكين صاحب المتجر من تخصيص مكونات المتجر، نحتاج إلى تخزين إعدادات كل مكون في قاعدة البيانات. سوف نستخدم حقل JSONB لتخزين إعدادات متنوعة لكل مكون:

```json
// مثال لإعدادات الهيرو
{
  "title": "أحدث المنتجات",
  "description": "تسوق أحدث منتجاتنا المختارة بعناية بأفضل الأسعار التنافسية.",
  "primaryButton": {
    "text": "تصفح الكل",
    "link": "/products"
  },
  "secondaryButton": {
    "text": "العروض الخاصة",
    "link": "/offers"
  },
  "imageUrl": "https://example.com/hero-image.jpg",
  "trustBadges": [
    {
      "id": "1",
      "text": "توصيل سريع",
      "icon": "Truck"
    },
    {
      "id": "2",
      "text": "دفع آمن",
      "icon": "ShieldCheck"
    },
    {
      "id": "3",
      "text": "جودة عالية",
      "icon": "Gem"
    }
  ]
}
```

### المراحل المستقبلية

بعد الانتهاء من تطوير مكون تحرير الهيرو، سنستمر في تطوير باقي المكونات:

1. **تحرير قسم الفئات**:
   - تحديد عدد الفئات التي ستظهر
   - خيارات عرض الفئات (شبكة، شريط، بطاقات)
   - تخصيص العنوان والوصف

2. **تحرير قسم المنتجات المميزة**:
   - تحديد معايير اختيار المنتجات المميزة (الأكثر مبيعًا، المضافة يدويًا، الأحدث)
   - تحديد عدد المنتجات التي ستظهر
   - ضبط أنماط العرض

3. **تحرير قسم آراء العملاء**:
   - إمكانية إضافة وحذف وتحرير آراء العملاء
   - تحديد عدد الآراء التي ستظهر
   - تغيير نمط الشرائح والعرض

4. **تحرير قسم عن المتجر**:
   - تحرير النص والوصف
   - تحديث الصورة
   - تعديل المميزات والإحصائيات

### واجهة السحب والإفلات الكاملة

في المرحلة النهائية، سيتمكن صاحب المتجر من:

1. إضافة وإزالة مكونات من صفحة المتجر
2. إعادة ترتيب المكونات بالسحب والإفلات
3. تخصيص محتوى كل مكون بشكل كامل
4. معاينة التغييرات قبل نشرها
5. نشر التغييرات مباشرة على المتجر

### مكونات النظام المطلوب تطويرها

1. **المكونات الرئيسية**:
   - `StoreEditor.tsx`: الصفحة الرئيسية للتحرير
   - `ComponentDropzone.tsx`: مكون يستقبل السحب والإفلات
   - `ComponentList.tsx`: قائمة بالمكونات المتاحة
   - `PreviewPane.tsx`: لوحة المعاينة المباشرة

2. **مكونات تحرير خاصة بكل قسم**:
   - `HeroEditor.tsx`
   - `CategoriesEditor.tsx`
   - `FeaturedProductsEditor.tsx`
   - `TestimonialsEditor.tsx`
   - `AboutEditor.tsx`

3. **واجهات API المطلوبة**:
   - `GET /api/store-settings`: جلب إعدادات المتجر
   - `PUT /api/store-settings`: تحديث إعدادات المتجر
   - `POST /api/upload`: رفع الصور والملفات

## الخطوات القادمة

1. إنشاء قاعدة البيانات لتخزين إعدادات المتجر
2. تطوير مكون تحرير الهيرو
3. إنشاء واجهة المستخدم للسحب والإفلات
4. ربط التحديثات بقاعدة البيانات
5. تنفيذ نظام المعاينة المباشرة
6. اختبار والتحقق من الوظائف

من خلال هذا التطوير، سيحصل أصحاب المتاجر على مرونة كاملة في تخصيص واجهة متاجرهم دون الحاجة إلى معرفة برمجية، تمامًا كما هو الحال في منصات مثل Wix. 