# ๐ ุงูุชูุงูู ุจูู ูุธุงู ุงูุนููุงุก ููุดู 104

## ๐ **ูุธุฑุฉ ุนุงูุฉ:**

ุชู ุฅุถุงูุฉ ุชูุงูู ูุงูู ุจูู **ูุธุงู ุงูุนููุงุก** ู **ูุธุงู ูุดู 104** ูุชุณููู ุฅุนุฏุงุฏ ุงููุดู ุงูุถุฑูุจู ุงูุณููู.

---

## โ **ูุง ุชู ุฅูุฌุงุฒู:**

### **1. ุชุญุฏูุซ ููุน ุงูุนููู (Customer Type)**
๐ `src/types/customer.ts`

**ุงูุญููู ุงูุฌุฏูุฏุฉ (ุงุฎุชูุงุฑูุฉ):**
- โ `nif` - ุฑูู ุงูุชุนุฑูู ุงูุฌุจุงุฆู (15 ุฑูู)
- โ `rc` - ุฑูู ุงูุณุฌู ุงูุชุฌุงุฑู
- โ `nis` - ุฑูู ุงูุชุนุฑูู ุงูุฅุญุตุงุฆู
- โ `rib` - ุงููููุฉ ุงูุจูููุฉ
- โ `address` - ุงูุนููุงู ุงููุงูู

### **2. ุชุญุฏูุซ ูููุฐุฌ ุฅุถุงูุฉ ุงูุนููุงุก**
๐ `src/components/customers/AddCustomerDialog.tsx`

**ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:**
- โ ูุณู "ูุนูููุงุช ุถุฑูุจูุฉ (ุงุฎุชูุงุฑู)"
- โ ุญููู NIF, RC, NIS, RIB, Address
- โ ุงูุชุญูู ูู ุตุญุฉ NIF (15 ุฑูู)
- โ ุงูุชุญูู ูู ุตุญุฉ RC (ุฃุฑูุงู ููุท)
- โ ูุงุฌูุฉ ุณููุฉ ูููุธูุฉ

### **3. ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช**
๐ `database/migrations/add_tax_fields_to_customers.sql`

**ุงูุชุบููุฑุงุช:**
- โ ุฅุถุงูุฉ 5 ุฃุนูุฏุฉ ุฌุฏูุฏุฉ ูุฌุฏูู `customers`
- โ ููุงุฑุณ ุนูู NIF ู RC ููุจุญุซ ุงูุณุฑูุน
- โ ุชุนูููุงุช ุชูุถูุญูุฉ ุนูู ุงูุฃุนูุฏุฉ

### **4. ุฏูุงู ุงูุชูุงูู**
๐ `src/services/etat104Service.ts`

**ุงูุฏูุงู ุงูุฌุฏูุฏุฉ:**
- โ `importCustomersToEtat104` - ุงุณุชูุฑุงุฏ ุงูุนููุงุก ุชููุงุฆูุงู
- โ `findCustomerByTaxInfo` - ุงูุจุญุซ ุนู ุนููู ุญุณุจ NIF/RC

---

## ๐ **ููููุฉ ุงูุงุณุชุฎุฏุงู:**

### **ุงูุฎุทูุฉ 1: ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช**
```bash
# ูู Supabase SQL Editor
# ุดุบูู ุงูููู: database/migrations/add_tax_fields_to_customers.sql
```

### **ุงูุฎุทูุฉ 2: ุฅุถุงูุฉ ุนููุงุก ุจูุนูููุงุช ุถุฑูุจูุฉ**

ุนูุฏ ุฅุถุงูุฉ ุนููู ุฌุฏูุฏ:
1. ุงููุฃ ุงูุญููู ุงูุฃุณุงุณูุฉ (ุงูุงุณูุ ุงูุจุฑูุฏุ ุงููุงุชู)
2. **ุงุฎุชูุงุฑู:** ุงููุฃ ุงููุนูููุงุช ุงูุถุฑูุจูุฉ:
   - NIF (15 ุฑูู)
   - RC (ุฃุฑูุงู ููุท)
   - NIS
   - RIB
   - ุงูุนููุงู

### **ุงูุฎุทูุฉ 3: ุงุณุชูุฑุงุฏ ุงูุนููุงุก ุฅูู ูุดู 104**

```typescript
import { importCustomersToEtat104 } from '@/services/etat104Service';

// ุงุณุชูุฑุงุฏ ุชููุงุฆู
const result = await importCustomersToEtat104(
  declarationId,    // ูุนุฑู ุงููุดู
  organizationId,   // ูุนุฑู ุงููุคุณุณุฉ
  2024              // ุงูุณูุฉ ุงููุงููุฉ
);

console.log(`ุชู ุงุณุชูุฑุงุฏ ${result.imported} ุนููู`);
console.log(`ุชู ุชุฎุทู ${result.skipped} ุนููู`);
console.log(`ุฃุฎุทุงุก: ${result.errors.length}`);
```

---

## ๐ **ุขููุฉ ุงูุงุณุชูุฑุงุฏ ุงูุชููุงุฆู:**

### **ูุง ูุญุฏุซ ุนูุฏ ุงูุงุณุชูุฑุงุฏ:**

1. **ุฌูุจ ุงูุนููุงุก:**
   - ูุชู ุฌูุจ ุฌููุน ุงูุนููุงุก ุงูุฐูู ูุฏููู NIF ู RC
   - ุงูุนููุงุก ุจุฏูู ูุนูููุงุช ุถุฑูุจูุฉ ูุชู ุชุฎุทููู

2. **ุญุณุงุจ ุงููุจูุนุงุช:**
   - ูุชู ุฌูุจ ุฌููุน ุทูุจุงุช ุงูุนููู ูู ุงูุณูุฉ ุงููุญุฏุฏุฉ
   - ุญุณุงุจ ุฅุฌูุงูู ุงููุจูุนุงุช (HT + TVA)
   - ุงูุนููุงุก ุจุฏูู ูุจูุนุงุช ูุชู ุชุฎุทููู

3. **ุฅุถุงูุฉ ุฅูู ุงููุดู:**
   - ูุชู ุฅูุดุงุก ุณุฌู ูู `etat104_clients`
   - ุญุงูุฉ ุงูุชุญูู: `pending`
   - ูููู ุงูุชุญูู ูู NIF/RC ูุงุญูุงู

---

## ๐ฏ **ุญุงูุงุช ุงูุงุณุชุฎุฏุงู:**

### **1. ุฅุถุงูุฉ ุนููู ุฌุฏูุฏ ุจูุนูููุงุช ุถุฑูุจูุฉ:**
```typescript
// ูู ูููุฐุฌ ุฅุถุงูุฉ ุงูุนููู
{
  name: "ุดุฑูุฉ ูุซุงู",
  email: "example@company.dz",
  phone: "0555123456",
  nif: "123456789012345",  // 15 ุฑูู
  rc: "12345678",          // ุฑูู ุงูุณุฌู ุงูุชุฌุงุฑู
  nis: "001",              // ุงุฎุชูุงุฑู
  rib: "00123456789012345678901234",  // ุงุฎุชูุงุฑู
  address: "ุงูุฌุฒุงุฆุฑ ุงูุนุงุตูุฉ"  // ุงุฎุชูุงุฑู
}
```

### **2. ุงุณุชูุฑุงุฏ ุชููุงุฆู ูููุดู:**
```typescript
// ูู ุตูุญุฉ ูุดู 104
const handleImport = async () => {
  const result = await importCustomersToEtat104(
    declarationId,
    organizationId,
    2024
  );
  
  if (result.imported > 0) {
    toast.success(`ุชู ุงุณุชูุฑุงุฏ ${result.imported} ุนููู ุจูุฌุงุญ`);
  }
  
  if (result.errors.length > 0) {
    console.error('ุฃุฎุทุงุก ุงูุงุณุชูุฑุงุฏ:', result.errors);
  }
};
```

### **3. ุงูุจุญุซ ุนู ุนููู:**
```typescript
import { findCustomerByTaxInfo } from '@/services/etat104Service';

// ุงูุจุญุซ ุจู NIF
const customer = await findCustomerByTaxInfo(
  organizationId,
  "123456789012345"  // NIF
);

// ุฃู ุงูุจุญุซ ุจู RC
const customer2 = await findCustomerByTaxInfo(
  organizationId,
  undefined,
  "12345678"  // RC
);
```

---

## ๐ **ุงููุชุทูุจุงุช:**

### **ููุงุณุชูุฑุงุฏ ุงูุชููุงุฆู:**
- โ ุงูุนููู ูุฌุจ ุฃู ูููู ูุฏูู **NIF** ู **RC**
- โ ุงูุนููู ูุฌุจ ุฃู ูููู ูุฏูู ูุจูุนุงุช ูู ุงูุณูุฉ ุงููุญุฏุฏุฉ
- โ ุงููุจูุนุงุช ูุฌุจ ุฃู ุชููู ูุณุฌูุฉ ูู `pos_orders`

### **ููุชุญูู:**
- โ NIF: 15 ุฑูู ุจุงูุถุจุท
- โ RC: ุฃุฑูุงู ููุท
- โ NIS: ุงุฎุชูุงุฑู
- โ RIB: ุงุฎุชูุงุฑู
- โ Address: ุงุฎุชูุงุฑู

---

## ๐ **ุณูุฑ ุงูุนูู ุงููุงูู:**

```
1. ุฅุถุงูุฉ ุนููุงุก ูุน ูุนูููุงุช ุถุฑูุจูุฉ
   โ
2. ุชุณุฌูู ุงููุจูุนุงุช ุนูู ูุฏุงุฑ ุงูุณูุฉ
   โ
3. ูู ููุงูุฉ ุงูุณูุฉ: ุฅูุดุงุก ูุดู 104
   โ
4. ุงุณุชูุฑุงุฏ ุงูุนููุงุก ุชููุงุฆูุงู
   โ
5. ูุฑุงุฌุนุฉ ุงูุจูุงูุงุช ูุงูุชุญูู
   โ
6. ุชุตุฏูุฑ ุงููุดู ูุชูุฏููู ููู DGI
```

---

## ๐จ **ุงููุงุฌูุฉ ุงููุญุฏุซุฉ:**

### **ูููุฐุฌ ุฅุถุงูุฉ ุงูุนููู:**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุฅุถุงูุฉ ุนููู ุฌุฏูุฏ                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ุงูุงุณู *                              โ
โ [________________]                   โ
โ                                      โ
โ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู *                 โ
โ [________________]                   โ
โ                                      โ
โ ุฑูู ุงููุงุชู                          โ
โ [________________]                   โ
โ                                      โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ ูุนูููุงุช ุถุฑูุจูุฉ (ุงุฎุชูุงุฑู)            โ
โ                                      โ
โ ุฑูู ุงูุชุนุฑูู ุงูุฌุจุงุฆู (NIF)           โ
โ [_______________] (15 ุฑูู)          โ
โ                                      โ
โ ุฑูู ุงูุณุฌู ุงูุชุฌุงุฑู (RC)              โ
โ [_______________]                    โ
โ                                      โ
โ ุฑูู ุงูุชุนุฑูู ุงูุฅุญุตุงุฆู (NIS)          โ
โ [_______________]                    โ
โ                                      โ
โ ุงููููุฉ ุงูุจูููุฉ (RIB)                โ
โ [_______________]                    โ
โ                                      โ
โ ุงูุนููุงู ุงููุงูู                      โ
โ [_______________]                    โ
โ                                      โ
โ [ุฅูุบุงุก]  [ุญูุธ ุงูุนููู]              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## โ๏ธ **ููุงุญุธุงุช ูููุฉ:**

### **1. ุงูุญููู ุงูุงุฎุชูุงุฑูุฉ:**
- ุฌููุน ุงูุญููู ุงูุถุฑูุจูุฉ **ุงุฎุชูุงุฑูุฉ**
- ููู ููุงุณุชูุฑุงุฏ ุงูุชููุงุฆูุ **NIF ู RC ุฅูุฒุงููุงู**

### **2. ุงูุฎุตูุตูุฉ:**
- ุงููุนูููุงุช ุงูุถุฑูุจูุฉ ุญุณุงุณุฉ
- ูุชู ุชุฎุฒูููุง ุจุดูู ุขูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- RLS ููุนูู ุนูู ุฌุฏูู customers

### **3. ุงูุชุญูู:**
- ุงูุชุญูู ูู NIF: 15 ุฑูู ููุท
- ุงูุชุญูู ูู RC: ุฃุฑูุงู ููุท
- ูููู ุฅุถุงูุฉ ุชุญูู ุฅุถุงูู ูู API ุงูุญูููู

### **4. ุงูุฃุฏุงุก:**
- ุงูุงุณุชูุฑุงุฏ ุงูุชููุงุฆู ูุฏ ูุณุชุบุฑู ููุชุงู ููุนููุงุก ุงููุซูุฑูู
- ูุชู ูุนุงูุฌุฉ ุงูุนููุงุก ูุงุญุฏุงู ุชูู ุงูุขุฎุฑ
- ูุชู ุนุฑุถ ุชูุฏู ุงูุนูููุฉ

---

## ๐ง **ุงูุชุฎุตูุต:**

### **ุฅุถุงูุฉ ุญููู ุฅุถุงููุฉ:**

ุฅุฐุง ุฃุฑุฏุช ุฅุถุงูุฉ ุญููู ุฃุฎุฑู:

1. **ุชุญุฏูุซ ุงูููุน:**
```typescript
// ูู customer.ts
export interface Customer {
  // ... ุงูุญููู ุงูููุฌูุฏุฉ
  custom_field?: string;
}
```

2. **ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```sql
ALTER TABLE customers
ADD COLUMN custom_field VARCHAR(255);
```

3. **ุชุญุฏูุซ ุงููููุฐุฌ:**
```tsx
// ูู AddCustomerDialog.tsx
<Input
  id="custom_field"
  name="custom_field"
  value={formData.custom_field}
  onChange={handleChange}
/>
```

---

## ๐ **ุงูุฅุญุตุงุฆูุงุช:**

### **ูุง ุชู ุฅุถุงูุชู:**
- โ 5 ุญููู ุฌุฏูุฏุฉ ูู Customer type
- โ ูุณู ูุงูู ูู ูููุฐุฌ ุฅุถุงูุฉ ุงูุนููุงุก
- โ 2 ุฏุงูุฉ ุชูุงูู ุฌุฏูุฏุฉ
- โ ููู SQL ููุชุญุฏูุซ
- โ ููุงุฑุณ ููุจุญุซ ุงูุณุฑูุน
- โ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช

### **ุงูููุงุฆุฏ:**
- ๐ ุงุณุชูุฑุงุฏ ุชููุงุฆู ููุนููุงุก
- ๐ ุญุณุงุจ ุชููุงุฆู ูููุจูุนุงุช
- โ ุชูููู ุงูุฃุฎุทุงุก ุงููุฏููุฉ
- โฑ๏ธ ุชูููุฑ ุงูููุช
- ๐ ุฃูุงู ุงูุจูุงูุงุช

---

## โ **ูุงุฆูุฉ ุงูุชุญูู:**

- [ ] ุชุดุบูู ููู SQL ูู Supabase
- [ ] ุฅุถุงูุฉ ุนููุงุก ุจูุนูููุงุช ุถุฑูุจูุฉ
- [ ] ุงุฎุชุจุงุฑ ุงูุงุณุชูุฑุงุฏ ุงูุชููุงุฆู
- [ ] ูุฑุงุฌุนุฉ ุงูุจูุงูุงุช ุงููุณุชูุฑุฏุฉ
- [ ] ุงูุชุญูู ูู NIF ู RC
- [ ] ุชุตุฏูุฑ ุงููุดู

---

## ๐ **ุงููุธุงู ุฌุงูุฒ!**

ุงูุขู ููููู:
1. โ ุฅุถุงูุฉ ุนููุงุก ุจูุนูููุงุช ุถุฑูุจูุฉ ูุงููุฉ
2. โ ุงุณุชูุฑุงุฏ ุงูุนููุงุก ุชููุงุฆูุงู ุฅูู ูุดู 104
3. โ ุญุณุงุจ ุงููุจูุนุงุช ุชููุงุฆูุงู
4. โ ุชูููุฑ ุงูููุช ูุงูุฌูุฏ

**ูููุฒูุฏ ูู ุงููุนูููุงุช:**
- ุฑุงุฌุน: `ETAT104_COMPLETE.md`
- ุฑุงุฌุน: `ETAT104_SETUP.md`
