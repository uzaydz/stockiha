<!DOCTYPE html>
<html lang="ar" dir="rtl" class="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>سطوكيها - منصة إدارة المتاجر الذكية</title>
    <meta name="description" content="سطوكيها - منصة إدارة المتاجر الذكية لإنشاء متجرك الإلكتروني وإدارة المبيعات والمخزون بكل سهولة" />
    <meta name="author" content="سطوكيها" />
    
    <!-- إضافة سكريبت للتعامل مع وضع الإضاءة -->
    <script>
      // حاول تطبيق الوضع المحفوظ قبل تحميل الصفحة لمنع وميض الشاشة
      const storedTheme = localStorage.getItem('theme') || 'light';
      const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      const initialTheme = storedTheme === 'system' ? systemTheme : storedTheme;
      document.documentElement.classList.add(initialTheme);
      document.documentElement.style.colorScheme = initialTheme;
    </script>
    
    <!-- Polyfill for process -->
    <script>
      window.process = window.process || { env: {} };
      window.global = window.global || window;
    </script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">

    <meta property="og:title" content="سطوكيها - منصة إدارة المتاجر الذكية" />
    <meta property="og:description" content="منصة إدارة المتاجر الذكية لإنشاء متجرك الإلكتروني وإدارة المبيعات والمخزون بكل سهولة" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/icon.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@stockiha" />
    <meta name="twitter:image" content="/icon.png" />
    
    <!-- PWA Support -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#6b21a8">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    
    <!-- مخصص لـ Vercel و SPA -->
    <meta name="vercel-deployment" content="true">
    <meta name="format-detection" content="telephone=no">

    <!-- نظام إدارة الثيمات الموحد - يمنع الوميض ويطبق الألوان فوراً -->
    <script>
      (function() {
        try {
          // تحديد نوع الصفحة الحالية
          function getCurrentPageType() {
            const hostname = window.location.hostname;
            const pathname = window.location.pathname;
            
            // إذا كان في لوحة التحكم
            if (pathname.startsWith('/admin') || pathname.startsWith('/dashboard')) {
              return 'admin';
            }
            
            // إذا كان نطاق فرعي أو نطاق مخصص (متجر)
            if (hostname.includes('.') && !hostname.startsWith('www.')) {
              const parts = hostname.split('.');
              if (parts.length > 2 || (parts.length === 2 && parts[1] === 'localhost')) {
                return 'store';
              }
            }
            
            // التحقق من النطاق المخصص
            const storedOrgId = localStorage.getItem('bazaar_organization_id');
            if (storedOrgId) {
              return 'store';
            }
            
            return 'global';
          }
          
          // تحويل HEX إلى HSL مبسط
          function hexToHSL(hex) {
            hex = hex.replace(/^#/, '');
            
            if (!/^[0-9A-F]{6}$/i.test(hex)) {
              return '0 0% 50%'; // لون رمادي كقيمة افتراضية
            }
            
            const r = parseInt(hex.substring(0, 2), 16) / 255;
            const g = parseInt(hex.substring(2, 4), 16) / 255;
            const b = parseInt(hex.substring(4, 6), 16) / 255;
            
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h = 0, s = 0, l = (max + min) / 2;

            if (max !== min) {
              const d = max - min;
              s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
              
              switch (max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
              }
              h /= 6;
            }
            
            h = Math.round(h * 360);
            s = Math.round(s * 100);
            l = Math.round(l * 100);
            
            return h + ' ' + s + '% ' + l + '%';
          }
          
          // الألوان الافتراضية
          const DEFAULT_GLOBAL_COLORS = {
            primary: '#0099ff',
            secondary: '#6b21a8'
          };
          
          const DEFAULT_STORE_COLORS = {
            primary: '#22c55e',
            secondary: '#16a34a'
          };
          
          const pageType = getCurrentPageType();
          let primaryColor, secondaryColor;
          
          if (pageType === 'store' || pageType === 'admin') {
            // للمتاجر ولوحة التحكم، محاولة استرجاع ألوان المؤسسة
            const orgTheme = localStorage.getItem('bazaar_org_theme');
            const hostname = window.location.hostname;
            const cachedTheme = localStorage.getItem('org_theme_' + hostname);
            
            if (orgTheme) {
              try {
                const theme = JSON.parse(orgTheme);
                primaryColor = theme.primaryColor;
                secondaryColor = theme.secondaryColor;
              } catch (e) {}
            }
            
            if (!primaryColor && cachedTheme) {
              try {
                const theme = JSON.parse(cachedTheme);
                primaryColor = theme.primaryColor;
                secondaryColor = theme.secondaryColor;
              } catch (e) {}
            }
            
            // استخدام الألوان الافتراضية للمتجر إذا لم نجد ألوان محفوظة
            if (!primaryColor) {
              primaryColor = DEFAULT_STORE_COLORS.primary;
              secondaryColor = DEFAULT_STORE_COLORS.secondary;
            }
          } else {
            // للموقع العام، استخدام الألوان العامة
            const globalTheme = localStorage.getItem('bazaar_global_theme');
            
            if (globalTheme) {
              try {
                const theme = JSON.parse(globalTheme);
                primaryColor = theme.primaryColor;
                secondaryColor = theme.secondaryColor;
              } catch (e) {}
            }
            
            // استخدام الألوان الافتراضية العامة إذا لم نجد ألوان محفوظة
            if (!primaryColor) {
              primaryColor = DEFAULT_GLOBAL_COLORS.primary;
              secondaryColor = DEFAULT_GLOBAL_COLORS.secondary;
            }
          }
          
          // تطبيق الألوان فوراً
          if (primaryColor) {
            const primaryHSL = hexToHSL(primaryColor);
            document.documentElement.style.setProperty('--primary', primaryHSL, 'important');
            document.documentElement.style.setProperty('--ring', primaryHSL, 'important');
            document.documentElement.style.setProperty('--sidebar-primary', primaryHSL, 'important');
            document.documentElement.style.setProperty('--sidebar-ring', primaryHSL, 'important');
          }
          
          if (secondaryColor) {
            const secondaryHSL = hexToHSL(secondaryColor);
            document.documentElement.style.setProperty('--secondary', secondaryHSL, 'important');
            document.documentElement.style.setProperty('--secondary-foreground', '0 0% 100%', 'important');
          }
          
        } catch (error) {
          console.warn('خطأ في تطبيق الألوان المخزنة محلياً:', error);
        }
      })();
    </script>
  </head>

  <body>
    <div id="root"></div>
    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
  </body>
</html>
