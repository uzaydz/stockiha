-- =================================================================
-- إصلاح سياسة RLS لجدول products للسماح بقراءة المنتجات النشطة عامة
-- =================================================================

-- إضافة سياسة جديدة للقراءة العامة للمنتجات النشطة
CREATE POLICY "products_public_read_active" ON "public"."products"
AS PERMISSIVE FOR SELECT
TO public
USING (is_active = true);

-- ملاحظة: هذه السياسة ستعمل بجانب السياسة الموجودة products_read_safe
-- مما يعني أن المستخدمين المصادق عليهم يمكنهم رؤية جميع المنتجات (نشطة وغير نشطة)
-- بينما المستخدمون غير المصادق عليهم (anon) يمكنهم رؤية المنتجات النشطة فقط

-- للتأكد من أن السياسة تعمل، دعنا نتحقق من السياسات الحالية
-- SELECT policyname, cmd, qual FROM pg_policies WHERE tablename = 'products' AND cmd = 'SELECT'; 