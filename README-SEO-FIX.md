# إصلاح مشكلة إعدادات تحسين محركات البحث (SEO)

## وصف المشكلة

هناك مشكلة في النظام الحالي لإعدادات SEO حيث أن التغييرات التي يتم إجراؤها لا يتم تخزينها بشكل صحيح في قاعدة البيانات. المشكلة على وجه التحديد:

1. إعدادات SEO يتم تخزينها في حقل `custom_js` في جدول `organization_settings` كجزء من كائن JSON
2. يجب أيضًا تخزين هذه الإعدادات بشكل منفصل في جدول `store_settings` مع `component_type` تساوي `seo_settings`
3. حاليًا، عند حفظ الإعدادات من واجهة المستخدم، يتم تحديث الحقل `custom_js` فقط، ولا يتم تحديث جدول `store_settings`

## الحل

تم تنفيذ إصلاح يتضمن:

1. تحديث الوظيفة `update_store_seo_settings` لضمان أنها تعمل بشكل صحيح وتتعامل مع الأخطاء
2. إضافة وظيفة `fix_seo_settings` تقوم بمزامنة إعدادات SEO من `custom_js` إلى جدول `store_settings`
3. تحديث الهوك `useOrganizationSettings` ليقوم بحفظ إعدادات SEO في جدول `store_settings` بشكل منفصل

## خطوات التطبيق

1. قم بتنفيذ ملف SQL المرفق:

```bash
psql -U [اسم المستخدم] -d [اسم قاعدة البيانات] -f sql/fix_seo_settings.sql
```

أو قم بتنفيذ الملف من خلال واجهة SQL في Supabase أو أي أداة إدارة قاعدة بيانات أخرى.

2. تم تحديث الكود في `src/hooks/useOrganizationSettings.ts` ليقوم بما يلي:
   - تعريف واجهة `SEOSettings` و `CustomJsData`
   - إضافة وظيفة `saveSEOSettings` تقوم بحفظ إعدادات SEO في جدول `store_settings`
   - تعديل وظيفة `saveSettings` لتقوم بحفظ إعدادات SEO بشكل منفصل

3. بعد تطبيق هذا الإصلاح، يجب أن تعمل إعدادات SEO بشكل صحيح وأن يتم حفظها في قاعدة البيانات.

## التحقق من الإصلاح

للتحقق من أن الإصلاح يعمل بشكل صحيح، قم بما يلي:

1. قم بتغيير إعدادات SEO من واجهة المستخدم وحفظها
2. تحقق من قاعدة البيانات باستخدام الاستعلام التالي:

```sql
SELECT settings FROM public.store_settings 
WHERE component_type = 'seo_settings' 
AND organization_id = '[معرف المؤسسة]';
```

3. تأكد من أن الإعدادات تظهر بشكل صحيح في نتيجة الاستعلام

## ملاحظات إضافية

- إذا كانت هناك أي مشاكل في عملية الإصلاح، تحقق من السجلات لمعرفة سبب الفشل
- في حال استمرار المشكلة، تأكد من أن وظيفة `update_store_seo_settings` موجودة وتعمل بشكل صحيح 