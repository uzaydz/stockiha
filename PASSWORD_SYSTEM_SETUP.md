# نظام تغيير كلمة المرور - دليل الإعداد

## نظرة عامة
تم تطوير نظام شامل لتغيير كلمة المرور للموظفين والمؤسسات مع ميزات أمان متقدمة.

## الملفات المضافة

### 1. مكونات جديدة
- `src/components/settings/PasswordSettings.tsx` - مكون تغيير كلمة المرور
- `src/pages/reset-password.tsx` - صفحة إعادة تعيين كلمة المرور

### 2. تحديثات الملفات الموجودة
- `src/pages/dashboard/settings/index.tsx` - إضافة تبويب الأمان

## الميزات المتاحة

### 1. تغيير كلمة المرور
- ✅ التحقق من كلمة المرور الحالية
- ✅ متطلبات كلمة مرور قوية
- ✅ تأكيد كلمة المرور الجديدة
- ✅ إظهار/إخفاء كلمات المرور
- ✅ مؤشرات بصرية للمتطلبات

### 2. إعادة تعيين كلمة المرور
- ✅ إرسال رابط إعادة التعيين عبر البريد الإلكتروني
- ✅ صفحة إعادة تعيين آمنة
- ✅ التحقق من صحة الرابط
- ✅ إعادة توجيه تلقائية بعد النجاح

### 3. متطلبات الأمان
- ✅ 8 أحرف على الأقل
- ✅ حرف كبير واحد على الأقل
- ✅ حرف صغير واحد على الأقل
- ✅ رقم واحد على الأقل
- ✅ رمز خاص واحد على الأقل

### 4. تجربة المستخدم
- ✅ واجهة سهلة الاستخدام
- ✅ رسائل خطأ واضحة
- ✅ مؤشرات التحميل
- ✅ نصائح الأمان

## كيفية الاستخدام

### 1. في صفحة الإعدادات
```tsx
// تم إضافة تبويب "الأمان والخصوصية" تلقائياً
// يحتوي على مكون PasswordSettings
```

### 2. تغيير كلمة المرور
1. انتقل إلى الإعدادات > الأمان والخصوصية
2. أدخل كلمة المرور الحالية
3. أدخل كلمة المرور الجديدة (مع مراعاة المتطلبات)
4. أكد كلمة المرور الجديدة
5. اضغط "تغيير كلمة المرور"

### 3. إعادة تعيين كلمة المرور
1. في صفحة الإعدادات، اضغط "إرسال رابط إعادة التعيين"
2. تحقق من بريدك الإلكتروني
3. اضغط على الرابط المرسل
4. أدخل كلمة المرور الجديدة
5. اضغط "إعادة تعيين كلمة المرور"

## التكامل مع Supabase Auth

### 1. تغيير كلمة المرور
```tsx
// التحقق من كلمة المرور الحالية
const { error: signInError } = await supabase.auth.signInWithPassword({
  email: user?.email || '',
  password: currentPassword
});

// تحديث كلمة المرور
const { error: updateError } = await supabase.auth.updateUser({
  password: newPassword
});
```

### 2. إعادة تعيين كلمة المرور
```tsx
// إرسال رابط إعادة التعيين
const { error } = await supabase.auth.resetPasswordForEmail(email, {
  redirectTo: `${window.location.origin}/reset-password`
});

// تحديث كلمة المرور (في صفحة إعادة التعيين)
const { error } = await supabase.auth.updateUser({
  password: newPassword
});
```

## إعدادات Supabase المطلوبة

### 1. إعدادات البريد الإلكتروني
تأكد من إعداد SMTP في Supabase لإرسال رسائل إعادة التعيين:

```
Settings > Auth > Email Templates > Reset Password
```

### 2. إعدادات إعادة التوجيه
في Supabase Dashboard:
```
Settings > Auth > URL Configuration
Site URL: https://yourdomain.com
Redirect URLs: https://yourdomain.com/reset-password
```

### 3. سياسات الأمان
```sql
-- تأكد من وجود سياسات RLS مناسبة
-- للسماح للمستخدمين بتحديث بياناتهم فقط
```

## الأمان والحماية

### 1. التحقق من كلمة المرور الحالية
- يتم التحقق من كلمة المرور الحالية قبل السماح بالتغيير
- يمنع تغيير كلمة المرور بدون معرفة الحالية

### 2. متطلبات كلمة المرور القوية
- طول أدنى 8 أحرف
- تنوع في أنواع الأحرف
- منع كلمات المرور الضعيفة

### 3. حماية الجلسة
- التحقق من صحة الجلسة في صفحة إعادة التعيين
- انتهاء صلاحية روابط إعادة التعيين

### 4. تشفير البيانات
- جميع كلمات المرور مشفرة في قاعدة البيانات
- استخدام Supabase Auth للتشفير الآمن

## استكشاف الأخطاء

### 1. مشاكل تغيير كلمة المرور
```
خطأ: "كلمة المرور الحالية غير صحيحة"
الحل: تأكد من إدخال كلمة المرور الصحيحة
```

```
خطأ: "فشل في تغيير كلمة المرور"
الحل: تحقق من اتصال الإنترنت وإعدادات Supabase
```

### 2. مشاكل إعادة التعيين
```
خطأ: "رابط إعادة التعيين غير صالح"
الحل: تأكد من إعدادات Redirect URLs في Supabase
```

```
خطأ: "فشل في إرسال رابط إعادة التعيين"
الحل: تحقق من إعدادات SMTP في Supabase
```

### 3. مشاكل متطلبات كلمة المرور
```
خطأ: عدم استيفاء المتطلبات
الحل: تأكد من أن كلمة المرور تحتوي على:
- 8 أحرف على الأقل
- حرف كبير وصغير
- رقم ورمز خاص
```

## الاختبار

### 1. اختبار تغيير كلمة المرور
1. سجل دخول بحساب موجود
2. انتقل إلى الإعدادات > الأمان
3. جرب تغيير كلمة المرور بكلمة ضعيفة (يجب أن يفشل)
4. جرب تغيير كلمة المرور بكلمة قوية (يجب أن ينجح)
5. سجل خروج وادخل بكلمة المرور الجديدة

### 2. اختبار إعادة التعيين
1. في صفحة الإعدادات، اضغط "إرسال رابط إعادة التعيين"
2. تحقق من وصول البريد الإلكتروني
3. اضغط على الرابط
4. أدخل كلمة مرور جديدة
5. تأكد من إعادة التوجيه إلى لوحة التحكم

## نصائح الأمان للمستخدمين

### 1. كلمة مرور قوية
- استخدم كلمة مرور فريدة
- تجنب المعلومات الشخصية
- استخدم مزيج من الأحرف والأرقام والرموز

### 2. الحفاظ على الأمان
- لا تشارك كلمة المرور مع أحد
- غير كلمة المرور بانتظام
- استخدم مدير كلمات مرور

### 3. الحذر من التصيد
- تأكد من الرابط قبل إدخال كلمة المرور
- لا تدخل كلمة المرور في مواقع مشبوهة
- تحقق من عنوان الموقع (HTTPS)

## الخطوات التالية

1. **اختبار النظام** في بيئة التطوير
2. **إعداد SMTP** في Supabase للبريد الإلكتروني
3. **تحديث إعدادات إعادة التوجيه** في Supabase
4. **نشر التحديثات** في بيئة الإنتاج
5. **تدريب المستخدمين** على استخدام النظام الجديد

## الدعم

في حالة وجود مشاكل:
1. تحقق من أخطاء وحدة التحكم
2. فحص إعدادات Supabase Auth
3. مراجعة سجلات البريد الإلكتروني
4. التأكد من صحة متغيرات البيئة 