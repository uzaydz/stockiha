# ุฏููู ุฅุตูุงุญ ุฎุทุฃ HTTP 406 (Not Acceptable) ูู Supabase

## ุงููุดููุฉ
ุนูุฏ ูุญุงููุฉ ุงููุตูู ุฅูู ุฌุฏูู `organizations` ูู ูุทุงู ูุฎุตุต (ูุซู fredstore40.stockiha.com)ุ ูุธูุฑ ุฎุทุฃ:
```
GET https://wrnssatuvmumsczyldth.supabase.co/rest/v1/organizations?select=id%2Cdomain%2Csubdomain&domain=eq.fredstore40.stockiha.com 406 (Not Acceptable)
```

## ุณุจุจ ุงููุดููุฉ
1. **RLS (Row Level Security)**: ุณูุงุณุงุช ุงูุฃูุงู ุนูู ุฌุฏูู organizations ูุฏ ุชููุน ุงููุตูู
2. **Headers ุบูุฑ ูุชูุงููุฉ**: Supabase ูุฏ ูุฑูุถ ุงูุทูุจ ุจุณุจุจ headers ุบูุฑ ููุจููุฉ
3. **ุตูุงุญูุงุช ุงููุฑุงุกุฉ**: ุนุฏู ูุฌูุฏ ุตูุงุญูุงุช ูุฑุงุกุฉ ุนุงูุฉ ููุฌุฏูู

## ุงูุญููู

### 1. ุชุทุจูู ุฅุตูุงุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช
ูู ุจุชูููุฐ ุงูููู SQL ุงูุชุงูู ูู Supabase:
```bash
# ุนุจุฑ Supabase Dashboard > SQL Editor
fix_406_organizations_issue.sql
```

### 2. ุชูุนูู ูุนุงูุฌ ุฃุฎุทุงุก HTTP 406
ุชุฃูุฏ ูู ุฃู ูุนุงูุฌ ุฃุฎุทุงุก 406 ููุนูู ูู `src/main.tsx`:
```typescript
// ุชููุฆุฉ ูุนุงูุฌ ุฃุฎุทุงุก 406 ููุฑุงู
if (typeof window !== 'undefined') {
  initializeHttp406Handler(); // ูุฌุจ ุฃู ูููู ููุนูู
  console.log('๐ ุชู ุชููุฆุฉ ูุนุงูุฌ ุฃุฎุทุงุก HTTP 406 ุงููุญุณู');
}
```

### 3. ุงูุชุญุฏูุซุงุช ูู ุงูููุฏ
ุชู ุชุญุฏูุซ `src/context/shop/utils.ts` ููุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุฃูุถู:
- ุงุณุชุฎุฏุงู `maybeSingle()` ุจุฏูุงู ูู `single()` ูุชุฌูุจ ุฃุฎุทุงุก "ูุง ุชูุฌุฏ ูุชุงุฆุฌ"
- ุฅุถุงูุฉ ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก ูุน ุฑุณุงุฆู ูุงุถุญุฉ ูู console

## ุงูุชุญูู ูู ุงูุฅุตูุงุญ

### 1. ูู ูุญุฏุฉ ุชุญูู ุงููุชุตูุญ
```javascript
// ุนุฑุถ ุฅุญุตุงุฆูุงุช ุฃุฎุทุงุก 406
get406Stats();

// ุฅุนุงุฏุฉ ูุญุงููุฉ ุงูุทูุจุงุช ุงููุงุดูุฉ
retryFailed406Requests();

// ูุณุญ ุงูุฅุญุตุงุฆูุงุช
reset406Stats();
```

### 2. ูู Supabase SQL Editor
```sql
-- ุงูุชุญูู ูู ุณูุงุณุงุช RLS
SELECT * FROM pg_policies 
WHERE tablename = 'organizations' 
AND schemaname = 'public';

-- ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
SELECT grantee, privilege_type 
FROM information_schema.role_table_grants 
WHERE table_name='organizations';
```

## ูุตุงุฆุญ ุฅุถุงููุฉ

1. **ูุณุญ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช**: ุงูุณุญ localStorage ูcookies ูููุชุตูุญ
2. **ุงูุชุญูู ูู ุงูุดุจูุฉ**: ุงุณุชุฎุฏู ุฃุฏูุงุช ุงููุทูุฑ ููุฑุงูุจุฉ ุงูุทูุจุงุช
3. **ุชุณุฌูู ุงูุฃุฎุทุงุก**: ุฑุงูุจ console ููุญุตูู ุนูู ูุนูููุงุช ุชูุตูููุฉ

## ุงูููุงูุฉ ุงููุณุชูุจููุฉ

1. **ุงุณุชุฎุฏุงู maybeSingle()**: ุฏุงุฆูุงู ุงุณุชุฎุฏู maybeSingle ุจุฏูุงู ูู single ุนูุฏ ุงูุจุญุซ ุนู ุณุฌู ูุฏ ูุง ูููู ููุฌูุฏุงู
2. **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก**: ุฃุถู ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก ูู ุฌููุน ุงุณุชุนูุงูุงุช Supabase
3. **ุณูุงุณุงุช RLS**: ุชุฃูุฏ ูู ูุฌูุฏ ุณูุงุณุงุช ูุฑุงุกุฉ ุนุงูุฉ ููุฌุฏุงูู ุงูุชู ุชุญุชุงุฌ ูููุตูู ุงูุนุงู

## ุงููุฑุงุฌุน
- [Supabase RLS Documentation](https://supabase.com/docs/guides/auth/row-level-security)
- [HTTP 406 Error Explanation](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/406)
- ููู ุงูุฅุตูุงุญ ุงูุฃุตูู: `HTTP_406_ERROR_SOLUTION.md`