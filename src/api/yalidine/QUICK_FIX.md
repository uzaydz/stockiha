# الإصلاح السريع لمشكلة رسوم ياليدين

هذا الملف يقدم إصلاحًا سريعًا وبسيطًا لمشكلة حذف بيانات رسوم ياليدين من قاعدة البيانات بعد عملية المزامنة.

## المشكلة

المشكلة الحالية تتمثل في:
1. يتم جلب بيانات الرسوم من API ياليدين بنجاح
2. يتم إدخال البيانات في جدول `yalidine_fees` في قاعدة البيانات
3. يتم حذف البيانات تلقائيًا بسبب قيد CASCADE على حقل `organization_id`
4. نتيجة لذلك، يظهر 0 سجل في الجدول رغم إتمام المزامنة بنجاح

## الحل السريع (خطوتين فقط)

### الخطوة 1: تطبيق ملف الإصلاح السريع

قم بتنفيذ الملف التالي في قاعدة البيانات:
```
migrations/yalidine_fees_fix_cascade.sql
```

هذا الملف يقوم بـ:
- إصلاح قيد المفتاح الأجنبي organization_id لمنع الحذف التلقائي
- إنشاء دالة آمنة لحذف سجلات الرسوم عند إعادة المزامنة
- إضافة فهارس وقيود لتحسين الأداء

### الخطوة 2: استخدام النسخة المحدثة من ملف fees-sync.ts

تم تحديث ملف `src/api/yalidine/fees-sync.ts` لاستخدام الدالة الجديدة للحذف الآمن وتحسين عملية حفظ البيانات.

## كيفية التحقق من نجاح الإصلاح

1. قم بتنفيذ عملية مزامنة جديدة
2. استخدم الاستعلام التالي للتحقق من وجود البيانات في قاعدة البيانات:

```sql
SELECT COUNT(*) FROM yalidine_fees WHERE organization_id = 'معرف_المؤسسة';
```

ينبغي أن ترى عددًا من السجلات بدلاً من الصفر.

## ملاحظات هامة

- احرص على تنفيذ ملف SQL للإصلاح أولاً قبل بدء عملية المزامنة
- إذا استمرت المشكلة، جرب الحل الشامل المتاح في `migrations/yalidine_fees_final_fix.sql`
- للمزيد من التفاصيل، راجع ملف `src/api/yalidine/README.md` 