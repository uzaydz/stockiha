# ๐ ุชุญููู ุดุงูู ููุธุงู ุงููุฒุงููุฉ ููุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ

**ุงูุชุงุฑูุฎ:** 2025-01-27  
**ุงูุญุงูุฉ:** ุชุญููู ุดุงูู ูุงูุชุฑุงุญุงุช ุชุญุณูู

---

## ๐ ุงูููุฎุต ุงูุชูููุฐู

ูุฏูู **ูุธุงูุงู ูุชูุงุฒูุงู** ูุนููุงู ูุนุงู:

1. **ูุธุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ:**
   - โ **SQLite** (ุงูุฃูุถู - ูู Tauri/Electron)
   - โ๏ธ **IndexedDB** (ููุชูุงูู - ูู ุงููุชุตูุญ)

2. **ูุธุงู ุงููุฒุงููุฉ:**
   - โ **SyncManager ุงูููุญุฏ** (ุงูุฃูุถู - Delta Sync)
   - โ๏ธ **ูุธุงู ุงููุฒุงููุฉ ุงููุฏูู** (Legacy - ููุชูุงูู)

---

## ๐ ุงูุฌุฒุก ุงูุฃูู: ุชุญููู ุฃูุธูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 1.1 SQLite (ุงููุธุงู ุงููุซุงูู) โญ

#### ุงููููุน ูุงููููุงุช:
- **ุงูููู ุงูุฑุฆูุณู:** `src/lib/db/tauriSchema.ts` (3,288 ุณุทุฑ)
- **ูุงุฌูุฉ SQLite:** `src/lib/db/sqliteAPI.ts`
- **ุงููุญูู:** `src/lib/db/dbAdapter.ts`
- **ุงููุฏูุฑ:** `electron/sqliteManager.cjs`

#### ุงููููุฒุงุช:
โ **ุฃุฏุงุก ูุงุฆู:** 10-50x ุฃุณุฑุน ูู IndexedDB  
โ **ุณุนุฉ ุบูุฑ ูุญุฏูุฏุฉ:** ูุง ููุฌุฏ ุญุฏ ุฃูุตู ููุญุฌู  
โ **SQL ูุงูู:** ุงุณุชุนูุงูุงุช ูุนูุฏุฉ ูJOINs  
โ **FTS5 ูุฏูุฌ:** ุจุญุซ ูุตู ูุงุฆู ุงูุณุฑุนุฉ  
โ **ACID ูุงูู:** ูุนุงููุงุช ุฐุฑูุฉ ููุซููุฉ  
โ **ูุณุฎ ุงุญุชูุงุทู ุณูู:** ููู ูุงุญุฏ ููุท  
โ **ุชุดููุฑ:** ุฏุนู SQLCipher  
โ **WAL Mode:** ุฃุฏุงุก ูุชุนุฏุฏ ุงููุฑุงุก/ุงููุชุงุจุฉ  

#### ุงูุจููุฉ:
```typescript
// Schema Version: 56 (ุขุฎุฑ ุฅุตุฏุงุฑ)
// ุงูุฌุฏุงูู: 50+ ุฌุฏูู ูุชุทุงุจู 100% ูุน Supabase
// ุงูููุงุฑุณ: 150+ ููุฑุณ ูุญุณูู
// Full-Text Search: FTS5 ููุจุญุซ ุงูุณุฑูุน
```

#### ุงูุงุณุชุฎุฏุงู ุงูุญุงูู:
```typescript
// ูู Tauri/Electron - ุงููุธุงู ุงูุฃุณุงุณู
if (isSQLiteAvailable()) {
  // ุงุณุชุฎุฏุงู SQLite
  await sqliteDB.query('SELECT * FROM products');
}
```

---

### 1.2 IndexedDB (ูุธุงู ุงูุชูุงูู) โ๏ธ

#### ุงููููุน ูุงููููุงุช:
- **ุงูููู ุงูุฑุฆูุณู:** `src/database/localDb.ts` (1,057 ุณุทุฑ)
- **ุงูููุชุจุฉ:** Dexie.js wrapper
- **ุงูุงุณู:** `bazaarDB_v2`
- **ุงูุฅุตุฏุงุฑ:** Version 18

#### ุงููููุฒุงุช:
โ **ูุนูู ูู ุงููุชุตูุญ:** ุจุฏูู ุชุซุจูุช  
โ **ุฏุนู ูุงูู ููู Web APIs**  
โ๏ธ **ุฃุฏุงุก ูุญุฏูุฏ:** ุฃุจุทุฃ ูู SQLite  
โ๏ธ **ุณุนุฉ ูุญุฏูุฏุฉ:** 50-250 MB  
โ๏ธ **ุงุณุชุนูุงูุงุช ุจุณูุทุฉ:** ูุง JOINs ูุนูุฏุฉ  

#### ุงูุงุณุชุฎุฏุงู ุงูุญุงูู:
```typescript
// ูู ุงููุชุตูุญ - ููุชูุงูู ููุท
if (!isSQLiteAvailable()) {
  // ุงุณุชุฎุฏุงู IndexedDB
  await inventoryDB.products.get(id);
}
```

---

### 1.3 ุงููุญูู ุงูููุญุฏ (dbAdapter) ๐

#### ุงูููู: `src/lib/db/dbAdapter.ts`

**ุงููุธููุฉ:** ูููุฑ ูุงุฌูุฉ ููุญุฏุฉ ุชุฎูู ุงูุงุฎุชูุงูุงุช ุจูู SQLite ูIndexedDB

```typescript
// ููุณ ุงูููุฏ ูุนูู ูุน ููุง ุงููุธุงููู
const db = inventoryDB; // ูู localDb.ts
await db.products.put(product); // ูุนูู ุชููุงุฆูุงู ูุน SQLite ุฃู IndexedDB
```

**ุงููููุฒุงุช:**
- โ **ุดูุงููุฉ ูุงููุฉ:** ุงูููุฏ ูุง ูุนุฑู ุฃู ูุธุงู ูุณุชุฎุฏู
- โ **ุชุจุฏูู ุชููุงุฆู:** ุญุณุจ ุงูุจูุฆุฉ (Tauri/Electron vs Browser)
- โ **ุชูุงูู ุนูุณู:** ุงูููุฏ ุงููุฏูู ูุนูู ุจุฏูู ุชุนุฏูู

---

## ๐ ุงูุฌุฒุก ุงูุซุงูู: ุชุญููู ุฃูุธูุฉ ุงููุฒุงููุฉ

### 2.1 SyncManager ุงูููุญุฏ (ุงููุธุงู ุงููุซุงูู) โญ

#### ุงููููุน ูุงููููุงุช:
- **ุงูููู ุงูุฑุฆูุณู:** `src/lib/sync/core/SyncManager.ts` (1,144 ุณุทุฑ)
- **Pull Engine:** `src/lib/sync/core/PullEngine.ts`
- **Push Engine:** `src/lib/sync/core/PushEngine.ts`
- **Outbox Manager:** `src/lib/sync/core/queue/OutboxManager.ts`

#### ุงููููุฒุงุช:
โ **Delta Sync:** ูุฒุงููุฉ ุงูุชุบููุฑุงุช ููุท (ููุณ ูู ุงูุจูุงูุงุช)  
โ **ูุฒุงููุฉ ูุชูุงุฒูุฉ:** ุฌุฏุงูู ูุณุชููุฉ ุชุชุฒุงูู ุจุงูุชูุงุฒู  
โ **ุฌุฏููุฉ ุฐููุฉ:** ุญุณุจ ูุดุงุท ุงููุณุชุฎุฏู  
โ **Circuit Breaker:** ุญูุงูุฉ ูู ุงููุดู ุงููุชูุฑุฑ  
โ **Conflict Resolution:** ุญู ุงูุชุนุงุฑุถุงุช ุชููุงุฆูุงู  
โ **ุฃุณูุงุก ููุญุฏุฉ:** 100% ูุชุทุงุจู ูุน Supabase  
โ **Batch Processing:** ูุนุงูุฌุฉ ุฏูุนุงุช ูุจูุฑุฉ ุจููุงุกุฉ  

#### ุงูุจููุฉ:
```typescript
// SyncManager (Singleton)
โโโ PullEngine (ุณุญุจ ูู ุงูุณูุฑูุฑ)
โ   โโโ Delta Sync (ุงูุชุบููุฑุงุช ููุท)
โ   โโโ Parallel Pull (ุฌุฏุงูู ูุณุชููุฉ)
โ   โโโ Sequential Pull (ุฌุฏุงูู ุชุงุจุนุฉ)
โโโ PushEngine (ุฅุฑุณุงู ููุณูุฑูุฑ)
โ   โโโ OutboxManager (ูุงุฆูุฉ ุงูุงูุชุธุงุฑ)
โ   โโโ Batch Sender (ุฅุฑุณุงู ุฏูุนุงุช)
โ   โโโ Retry Logic (ุฅุนุงุฏุฉ ุงููุญุงููุฉ)
โโโ Smart Scheduler (ุฌุฏููุฉ ุฐููุฉ)
    โโโ Active Interval (2 ุฏูููุฉ)
    โโโ Idle Interval (5 ุฏูุงุฆู)
    โโโ Inactive Interval (15 ุฏูููุฉ)
```

#### ุงูุงุณุชุฎุฏุงู:
```typescript
// ุชููุฆุฉ
await syncManager.start(organizationId);

// ูุฒุงููุฉ ูุงููุฉ
const result = await syncManager.syncAll();

// ูุฒุงููุฉ ุฌุฏูู ูุญุฏุฏ
await syncManager.syncTable('products');

// ุฅุฌุจุงุฑ ูุฒุงููุฉ ููุฑูุฉ
await syncManager.forceSync();
```

#### ุงูุฌุฏุงูู ุงููุชุฒุงููุฉ:
- โ **Independent Tables:** (ูุฒุงููุฉ ูุชูุงุฒูุฉ)
  - `products`, `customers`, `categories`, `suppliers`, etc.
- โ **Dependent Tables:** (ูุฒุงููุฉ ูุชุณูุณูุฉ)
  - `orders`, `order_items`, `invoices`, `returns`, etc.

---

### 2.2 ูุธุงู ุงููุฒุงููุฉ ุงููุฏูู (Legacy) โ๏ธ

#### ุงููููุน ูุงููููุงุช:
- **ุงูููู ุงูุฑุฆูุณู:** `src/api/syncService.ts`
- **Smart Sync Engine:** `src/lib/sync/SmartSyncEngine.ts`
- **Sync Scheduler:** `src/api/syncScheduler.ts`

#### ุงูุญุงูุฉ:
โ๏ธ **Deprecated:** ุชู ุฅููุงู ูุนุธู ุงููุธุงุฆู  
โ๏ธ **ููุชูุงูู ููุท:** ูุนูู ููุท ูู ุงููุชุตูุญ/Electron ุงููุฏูู  

#### ุงููุธุงุฆู ุงููุนุทูุฉ:
```typescript
// โก Deprecated - ุงููุฒุงููุฉ ุชููุงุฆูุฉ ุนุจุฑ Delta Sync
export const syncUnsyncedProducts = async () => {
  console.log('[syncUnsyncedProducts] โก Deprecated');
  return { success: 0, failed: 0 };
};
```

---

### 2.3 SmartSyncEngine (ุงูุฌุณุฑ ุงูุฐูู) ๐

#### ุงูููู: `src/lib/sync/SmartSyncEngine.ts`

**ุงููุธููุฉ:** ูุฎุชุงุฑ ุงููุธุงู ุงูููุงุณุจ ุชููุงุฆูุงู

```typescript
// ูู Tauri/SQLite โ ูุณุชุฎุฏู SyncManager
if (isSQLiteAvailable() && orgId) {
  await syncManager.syncAll();
  return; // ูุง ูุญุชุงุฌ ุงููุฒุงููุฉ ุงููุฏููุฉ
}

// ูู ุงููุชุตูุญ โ ูุณุชุฎุฏู ุงููุฒุงููุฉ ุงููุฏููุฉ
await synchronizeWithServer(orgId);
```

**ุงููููุฒุงุช:**
- โ **Event-Driven:** ูุฒุงููุฉ ููุฑูุฉ ุนูุฏ ุงูุชุบููุฑุงุช (2 ุซุงููุฉ)
- โ **Debouncing:** ุชุฌููุน ุงูุชุบููุฑุงุช ุงููุชุนุฏุฏุฉ
- โ **Periodic Fallback:** ูุฒุงููุฉ ุฏูุฑูุฉ ูู 5 ุฏูุงุฆู ููุฃูุงู
- โ **ุชูููู 95% ูู ุงูุงุณุชุฏุนุงุกุงุช:** ุจูุถู ุงูุชุฌููุน ุงูุฐูู

---

## ๐ ุงูุฌุฒุก ุงูุซุงูุซ: ููุงุฑูุฉ ุดุงููุฉ

### 3.1 ููุงุฑูุฉ ููุงุนุฏ ุงูุจูุงูุงุช

| ุงูููุฒุฉ | SQLite โญ | IndexedDB โ๏ธ |
|--------|----------|--------------|
| **ุงูุฃุฏุงุก** | 10-50x ุฃุณุฑุน | ุจุทูุก ูุณุจูุงู |
| **ุงูุณุนุฉ** | ุบูุฑ ูุญุฏูุฏ | 50-250 MB |
| **ุงูุงุณุชุนูุงูุงุช** | SQL ูุงูู | ูุญุฏูุฏุฉ |
| **ุงูุจุญุซ ุงููุตู** | FTS5 ูุฏูุฌ | ูุฏูู |
| **ุงูุชุดููุฑ** | SQLCipher | โ ุบูุฑ ูุฏุนูู |
| **ุงููุณุฎ ุงูุงุญุชูุงุทู** | ููู ูุงุญุฏ | ุตุนุจ |
| **ุงูููุซูููุฉ** | ุนุงููุฉ ุฌุฏุงู | ูุชูุณุทุฉ |
| **ุงูุจูุฆุฉ** | Tauri/Electron | ุงููุชุตูุญ |
| **ุงูุชูุงูู** | โ ุงูุฃูุถู | โ๏ธ ููุชูุงูู ููุท |

**ุงููุชูุฌุฉ:** SQLite ูู ุงูุฎูุงุฑ ุงููุซุงูู ููุฃูููุงูู ุฃููุงู โญ

---

### 3.2 ููุงุฑูุฉ ุฃูุธูุฉ ุงููุฒุงููุฉ

| ุงูููุฒุฉ | SyncManager โญ | Legacy โ๏ธ |
|--------|---------------|-----------|
| **ููุน ุงููุฒุงููุฉ** | Delta Sync | Full Sync |
| **ุงูุฃุฏุงุก** | ุณุฑูุน ุฌุฏุงู | ุจุทูุก |
| **ุงุณุชููุงู ุงูุจูุงูุงุช** | ูููู ุฌุฏุงู | ูุซูุฑ |
| **ุงููุฒุงููุฉ ุงููุชูุงุฒูุฉ** | โ ูุนู | โ ูุง |
| **Conflict Resolution** | โ ุชููุงุฆู | โ๏ธ ูุฏูู |
| **Circuit Breaker** | โ ูุนู | โ ูุง |
| **ุงูุฌุฏููุฉ ุงูุฐููุฉ** | โ ูุนู | โ๏ธ ุจุณูุทุฉ |
| **ุงูุญุงูุฉ** | โ ูุดุท | โ๏ธ Deprecated |

**ุงููุชูุฌุฉ:** SyncManager ูู ุงููุธุงู ุงููุซุงูู โญ

---

## ๐ฏ ุงูุฌุฒุก ุงูุฑุงุจุน: ุงูุชูุตูุงุช ูุงูุชุญุณููุงุช

### 4.1 ุงููุธุงู ุงููุซุงูู ุงูุญุงูู โ

**ูุฏูู ุจุงููุนู ูุธุงู ูุซุงูู ููุฃูููุงูู ุฃููุงู:**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         SQLite + SyncManager              โ
โ         (ุงููุธุงู ุงููุซุงูู)                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Delta Sync (ุงูุชุบููุฑุงุช ููุท)             โ
โ  + Parallel Processing (ูุชูุงุฒู)         โ
โ  + Smart Scheduling (ุฐูู)              โ
โ  + Conflict Resolution (ุชููุงุฆู)         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 4.2 ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ ๐

#### 1. ุฅุฒุงูุฉ ุงูููุฏ ุงููุฏูู (Legacy Cleanup)

**ุงููููุงุช ุงููุฑุดุญุฉ ููุญุฐู:**
- โ๏ธ `src/api/syncService.ts` (ุงููุธุงุฆู ุงููุนุทูุฉ)
- โ๏ธ `src/api/syncScheduler.ts` (ุชู ุงุณุชุจุฏุงูู ุจู SyncManager)
- โ๏ธ `src/database/localDb.ts` (ุงูุงุนุชูุงุฏ ุนูู IndexedDB ููุท)

**โ๏ธ ุชุญุฐูุฑ:** ูุง ุชุญุฐู ุฅูุง ุจุนุฏ ุงูุชุฃูุฏ ูู:
- โ ุฌููุน ุงูููุฏ ูุณุชุฎุฏู `dbAdapter` (ุงูุดูุงู)
- โ ุฌููุน ุงููุฒุงููุฉ ุชุณุชุฎุฏู `SyncManager`
- โ ูุง ููุฌุฏ ููุฏ ูุนุชูุฏ ูุจุงุดุฑุฉ ุนูู IndexedDB

#### 2. ุชุญุณููุงุช ุงูุฃุฏุงุก

**ุฃ. ุชุญุณูู ุงูููุงุฑุณ:**
```sql
-- ุฅุถุงูุฉ ููุงุฑุณ ููุจุญุซ ุงูุณุฑูุน
CREATE INDEX IF NOT EXISTS idx_products_name_lower 
ON products(name_lower);

CREATE INDEX IF NOT EXISTS idx_orders_customer_name_lower 
ON orders(customer_name_lower);

CREATE INDEX IF NOT EXISTS idx_orders_created_at 
ON orders(created_at DESC);
```

**ุจ. ุชุญุณูู ุงุณุชุนูุงูุงุช ุงููุฒุงููุฉ:**
```typescript
// ูู PullEngine.ts
// ุงุณุชุฎุฏุงู LIMIT ู OFFSET ููุฏูุนุงุช ุงููุจูุฑุฉ
const batchSize = 1000;
const results = await supabase
  .from(table)
  .select('*')
  .gt('updated_at', lastSyncTime)
  .limit(batchSize)
  .order('updated_at', { ascending: true });
```

**ุฌ. ุชุญุณูู Write Queue:**
```typescript
// ูู SQLiteWriteQueue.ts
// ุชุฌููุน ุงููุชุงุจุงุช ูู batches
const BATCH_SIZE = 100;
const writeBatch = [];

// ุนูุฏ ุงููุตูู ููุญุฏ ุงูุฃูุตูุ ุชูููุฐ ุฏูุนุฉ ูุงุญุฏุฉ
if (writeBatch.length >= BATCH_SIZE) {
  await executeBatch(writeBatch);
  writeBatch = [];
}
```

#### 3. ุชุญุณููุงุช ุงููุฒุงููุฉ

**ุฃ. ุชุญุณูู Smart Scheduler:**
```typescript
// ูู SyncManager.ts
// ุชูููู ุงููุชุฑุงุช ุนูุฏ ูุฌูุฏ ุชุบููุฑุงุช ูุซูุฑุฉ
private calculateNextSyncInterval(): number {
  const pendingCount = outboxManager.getPendingCount();
  
  if (pendingCount > 100) {
    return 30 * 1000; // 30 ุซุงููุฉ
  } else if (pendingCount > 50) {
    return 60 * 1000; // ุฏูููุฉ ูุงุญุฏุฉ
  }
  
  // ุงููุชุฑุงุช ุงูุนุงุฏูุฉ...
}
```

**ุจ. ุชุญุณูู Conflict Resolution:**
```typescript
// ูู PushEngine.ts
// ุงุณุชุฑุงุชูุฌูุฉ Last-Write-Wins ูุน ุญูุธ ุงููุณุฎ ุงููุฏููุฉ
if (conflict) {
  // ุญูุธ ุงููุณุฎุฉ ุงููุฏููุฉ ูู ุฌุฏูู conflicts
  await saveConflictVersion(record);
  
  // ุงุณุชุฎุฏุงู ุงููุณุฎุฉ ุงูุฃุญุฏุซ
  await updateRecord(latestVersion);
}
```

**ุฌ. ุชุญุณูู Retry Logic:**
```typescript
// ูู OutboxManager.ts
// Exponential Backoff
const retryDelays = [1000, 2000, 4000, 8000, 16000]; // ุจุงููููู ุซุงููุฉ

async retryOperation(operation, attempt) {
  const delay = retryDelays[Math.min(attempt, retryDelays.length - 1)];
  await new Promise(resolve => setTimeout(resolve, delay));
  // ุฅุนุงุฏุฉ ุงููุญุงููุฉ...
}
```

#### 4. ุชุญุณููุงุช ุงูุฃูุงู

**ุฃ. ุชุดููุฑ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ:**
```typescript
// ูู sqliteManager.cjs
// ุงุณุชุฎุฏุงู SQLCipher ููุชุดููุฑ
const db = new Database(dbPath, {
  key: encryptionKey, // ููุชุงุญ ุงูุชุดููุฑ
  cipher: 'aes-256-cbc'
});
```

**ุจ. ูุณุฎ ุงุญุชูุงุทู ุชููุงุฆู:**
```typescript
// ูู DatabaseMaintenance.ts
// ูุณุฎ ุงุญุชูุงุทู ูููู ุชููุงุฆู
async scheduleDailyBackup() {
  setInterval(async () => {
    const backupPath = await this.createBackup();
    // ุญุฐู ุงููุณุฎ ุงููุฏููุฉ (ุงูุงุญุชูุงุธ ุจู 7 ุฃูุงู ููุท)
    await this.cleanupOldBackups(7);
  }, 24 * 60 * 60 * 1000); // ูู 24 ุณุงุนุฉ
}
```

#### 5. ุชุญุณููุงุช ุงููุฑุงูุจุฉ ูุงูุชุดุฎูุต

**ุฃ. ุฅุถุงูุฉ Metrics:**
```typescript
// ูู SyncManager.ts
interface SyncMetrics {
  totalSyncs: number;
  averageSyncDuration: number;
  syncSuccessRate: number;
  pendingOperations: number;
  conflictsResolved: number;
  errorsCount: number;
}

// ุญูุธ Metrics ูู ุฌุฏูู sync_metrics
await saveMetrics(metrics);
```

**ุจ. ุฅุถุงูุฉ Dashboard:**
```typescript
// ูู NavbarSyncIndicator.tsx
// ุนุฑุถ ุฅุญุตุงุฆูุงุช ููุตูุฉ
const metrics = await syncManager.getMetrics();
console.log('๐ Sync Metrics:', {
  successRate: `${metrics.successRate}%`,
  avgDuration: `${metrics.avgDuration}ms`,
  pendingOps: metrics.pendingOps,
  conflicts: metrics.conflicts
});
```

---

## ๐๏ธ ุงูุฌุฒุก ุงูุฎุงูุณ: ุฏููู ุงูุชุนุฏููุงุช

### 5.1 ููููุฉ ุงูุชุญูู ูู ุงููุธุงู ุงููุณุชุฎุฏู

```typescript
import { isSQLiteAvailable, getDatabaseType } from '@/lib/db/sqliteAPI';

// ุงูุชุญูู ูู ููุน ูุงุนุฏุฉ ุงูุจูุงูุงุช
const dbType = getDatabaseType(); // 'sqlite' | 'indexeddb'

if (isSQLiteAvailable()) {
  console.log('โ SQLite ูุชุงุญ - ุงููุธุงู ุงููุซุงูู');
} else {
  console.log('โ๏ธ IndexedDB - ููุชูุงูู ููุท');
}
```

### 5.2 ููููุฉ ุงุณุชุฎุฏุงู SyncManager

```typescript
import { syncManager } from '@/lib/sync/core/SyncManager';

// 1. ุงูุชููุฆุฉ (ูุฑุฉ ูุงุญุฏุฉ ุนูุฏ ุจุฏุก ุงูุชุทุจูู)
await syncManager.start(organizationId);

// 2. ูุฒุงููุฉ ูุงููุฉ (ุชููุงุฆูุฉ - ูู 2-15 ุฏูููุฉ)
// ูุง ุญุงุฌุฉ ูุงุณุชุฏุนุงุก ูุฏูู - ูุนูู ุชููุงุฆูุงู

// 3. ูุฒุงููุฉ ููุฑูุฉ (ุนูุฏ ุงูุญุงุฌุฉ)
await syncManager.forceSync();

// 4. ูุฒุงููุฉ ุฌุฏูู ูุญุฏุฏ
await syncManager.syncTable('products');

// 5. ุงูุญุตูู ุนูู ุงูุฅุญุตุงุฆูุงุช
const stats = syncManager.getStats();
console.log('๐ Sync Stats:', stats);
```

### 5.3 ููููุฉ ุฅุถุงูุฉ ุฌุฏูู ุฌุฏูุฏ ูููุฒุงููุฉ

```typescript
// 1. ุฅุถุงูุฉ ุงูุฌุฏูู ูู tauriSchema.ts
await exec(orgId, `
  CREATE TABLE IF NOT EXISTS new_table (
    id TEXT PRIMARY KEY,
    organization_id TEXT NOT NULL,
    -- ุจุงูู ุงูุฃุนูุฏุฉ...
    _synced INTEGER DEFAULT 0,
    _sync_status TEXT,
    _pending_operation TEXT,
    _local_updated_at TEXT
  );
`);

// 2. ุฅุถุงูุฉ ูู SYNCED_TABLES
// ูู src/lib/sync/config.ts
export const SYNCED_TABLES = [
  // ... ุงูุฌุฏุงูู ุงูููุฌูุฏุฉ
  'new_table', // โ ุฅุถุงูุฉ ููุง
] as const;

// 3. ุชุญุฏูุฏ ููุน ุงูุฌุฏูู (ูุณุชูู ุฃู ุชุงุจุน)
export const INDEPENDENT_TABLES = [
  // ... ุงูุฌุฏุงูู ุงููุณุชููุฉ
  'new_table', // โ ุฅุฐุง ูุงู ูุณุชููุงู
] as const;

// ุฃู
export const DEPENDENT_TABLES = [
  // ... ุงูุฌุฏุงูู ุงูุชุงุจุนุฉ
  'new_table', // โ ุฅุฐุง ูุงู ุชุงุจุนุงู
] as const;
```

### 5.4 ููููุฉ ุฅุตูุงุญ ูุดุงูู ุงููุฒุงููุฉ

```typescript
// ูู Console ุงููุชุตูุญ (window.syncDiagnostics)

// 1. ุฅุนุงุฏุฉ ูุฒุงููุฉ ุฌุฏูู ูุญุฏุฏ
await syncDiagnostics.forceResync(['products']);

// 2. ุฅุตูุงุญ ุญุงูุฉ ุงููุฒุงููุฉ ููุทูุจุงุช
await syncDiagnostics.fixOrdersSyncStatus();

// 3. ุชูุธูู ุงูุนูููุงุช ุงููุงุดูุฉ
await syncDiagnostics.cleanupAll();

// 4. ุฅุตูุงุญ ุงูุทูุจุงุช ุจุฏูู items
await syncDiagnostics.fixOrdersWithoutItems();

// 5. ุชุดุบูู ุงุฎุชุจุงุฑุงุช ุงููุฒุงููุฉ
await syncDiagnostics.runOfflineTest();

// 6. ุตูุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
await syncDiagnostics.runMaintenance();
```

---

## ๐ ุงูุฌุฒุก ุงูุณุงุฏุณ: ุฎุทุฉ ุงูุชุญุณูู ุงูููุตู ุจูุง

### ุงููุฑุญูุฉ 1: ุงูุชุญุณููุงุช ุงูููุฑูุฉ (ุฃุณุจูุน ูุงุญุฏ)

1. โ **ุฅุถุงูุฉ ููุงุฑุณ ุฅุถุงููุฉ:**
   - ููุงุฑุณ ููุจุญุซ ุงููุตู (`name_lower`, `_customer_name_lower`)
   - ููุงุฑุณ ููุชูุงุฑูุฎ (`created_at`, `updated_at`)
   - ููุงุฑุณ ูููุฒุงููุฉ (`_synced`, `_pending_operation`)

2. โ **ุชุญุณูู Write Queue:**
   - ุชุฌููุน ุงููุชุงุจุงุช ูู batches (100 ุนูุตุฑ)
   - ุชูููู ุนุฏุฏ ุงููุนุงููุงุช

3. โ **ุชุญุณูู Smart Scheduler:**
   - ุชูููู ุงููุชุฑุงุช ุนูุฏ ูุฌูุฏ ุชุบููุฑุงุช ูุซูุฑุฉ
   - ุฒูุงุฏุฉ ุงููุชุฑุงุช ุนูุฏ ุนุฏู ูุฌูุฏ ูุดุงุท

### ุงููุฑุญูุฉ 2: ุงูุชุญุณููุงุช ุงููุชูุณุทุฉ (ุฃุณุจูุนูู)

1. โ **ุฅุถุงูุฉ Metrics:**
   - ุชุชุจุน ูุนุฏู ุงููุฌุงุญ
   - ุชุชุจุน ูุฏุฉ ุงููุฒุงููุฉ
   - ุชุชุจุน ุนุฏุฏ ุงูุชุนุงุฑุถุงุช

2. โ **ุชุญุณูู Conflict Resolution:**
   - ุญูุธ ูุณุฎ ูู ุงูุชุนุงุฑุถุงุช
   - ุงุณุชุฑุงุชูุฌูุฉ Last-Write-Wins ูุญุณููุฉ

3. โ **ุชุญุณูู Retry Logic:**
   - Exponential Backoff
   - ุชุญุฏูุฏ ุนุฏุฏ ุงููุญุงููุงุช ุงูุฃูุตู

### ุงููุฑุญูุฉ 3: ุงูุชุญุณููุงุช ุงููุชูุฏูุฉ (ุดูุฑ)

1. โ **ุฅุถุงูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุชููุงุฆู:**
   - ูุณุฎ ูููู ุชููุงุฆู
   - ุงูุงุญุชูุงุธ ุจู 7 ุฃูุงู ููุท

2. โ **ุฅุถุงูุฉ ุงูุชุดููุฑ:**
   - ุงุณุชุฎุฏุงู SQLCipher
   - ุชุดููุฑ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ

3. โ **ุฅุถุงูุฉ Dashboard:**
   - ุนุฑุถ ุฅุญุตุงุฆูุงุช ููุตูุฉ
   - ุฑุณูู ุจูุงููุฉ ููุฃุฏุงุก

---

## โ ุงูุฎูุงุตุฉ

### ูุฏูู ูุธุงูุงู:

1. **SQLite + SyncManager** โญ
   - โ ุงููุธุงู ุงููุซุงูู ููุฃูููุงูู ุฃููุงู
   - โ ูุนูู ูู Tauri/Electron
   - โ ุฃุฏุงุก ูุงุฆู ููุฒุงููุฉ ุฐููุฉ

2. **IndexedDB + Legacy Sync** โ๏ธ
   - โ๏ธ ููุชูุงูู ููุท (ุงููุชุตูุญ)
   - โ๏ธ ุฃุจุทุฃ ูุฃูู ููุงุกุฉ
   - โ๏ธ ูุนุธูู Deprecated

### ุงูุชูุตูุฉ ุงูููุงุฆูุฉ:

โ **ุงุณุชูุฑ ูู ุงุณุชุฎุฏุงู SQLite + SyncManager** - ูุฐุง ูู ุงููุธุงู ุงููุซุงูู!  
โ **ุฑูุฒ ุนูู ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ** - ูุชุญุณูู ุงูุฃุฏุงุก ุฃูุซุฑ  
โ **ุงุญุฐู ุงูููุฏ ุงููุฏูู ุชุฏุฑูุฌูุงู** - ุจุนุฏ ุงูุชุฃูุฏ ูู ุนุฏู ุงูุญุงุฌุฉ ุฅููู  

---

## ๐ ุงููุฑุงุฌุน

- `src/lib/sync/core/SyncManager.ts` - ูุฏูุฑ ุงููุฒุงููุฉ ุงูููุญุฏ
- `src/lib/db/tauriSchema.ts` - Schema SQLite ุงููุงูู
- `src/lib/db/dbAdapter.ts` - ุงููุญูู ุงูููุญุฏ
- `SQLITE_MIGRATION_GUIDE.md` - ุฏููู ุงูุชุฑุญูู
- `OFFLINE_IMPLEMENTATION_SUMMARY.md` - ููุฎุต ุงูุชุทุจูู

---

**ุชู ุฅูุดุงุก ูุฐุง ุงูุชูุฑูุฑ ุจูุงุณุทุฉ:** AI Assistant  
**ุขุฎุฑ ุชุญุฏูุซ:** 2025-01-27

























