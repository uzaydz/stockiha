<!DOCTYPE html>
<html lang="ar" dir="rtl" class="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Ø¥Ø²Ø§Ù„Ø© ÙˆØ³ÙˆÙ… http-equiv ØºÙŠØ± Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ù„Ø¶ØºØ· Ù„ØªÙØ§Ø¯ÙŠ Ø³Ù„ÙˆÙƒ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª/Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ -->
    
    <!-- Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ù…Ø§Ù† ØªÙØ¯Ø§Ø± Ù…Ù† Ø®Ù„Ø§Ù„ Vite middleware Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† meta element Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ frame-ancestors -->

    <title id="page-title">Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</title>
    <meta name="description" content="Ø³Ø·ÙˆÙƒÙŠÙ‡Ø§ - Ù…Ù†ØµØ© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ø°ÙƒÙŠØ© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…ØªØ¬Ø±Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø©" />
    <meta name="author" content="Ø³Ø·ÙˆÙƒÙŠÙ‡Ø§" />
    
    <!-- ğŸš€ INSTANT STORE TITLE SCRIPT - ÙŠØªÙ… ØªØ´ØºÙŠÙ„Ù‡ ÙÙˆØ±Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± -->
    <script nonce="{{CSP_NONCE}}">
      (function() {
        'use strict';
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ subdomain Ø§Ù„Ø­Ø§Ù„ÙŠ
        function getCurrentSubdomain() {
          try {
            const hostname = window.location.hostname;
            const parts = hostname.split('.');
            
            if (parts.length > 2 && parts[0] !== 'www' && hostname !== 'localhost') {
              return parts[0];
            }
            
            return null;
          } catch (e) {
            return null;
          }
        }
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…Ø®ØªÙ„ÙØ©
        function getInstantStoreName() {
          try {
            const subdomain = getCurrentSubdomain();
            if (!subdomain) return null;
            
            // 1. Ø§Ù„Ø¨Ø­Ø« ÙÙŠ sessionStorage Ø£ÙˆÙ„Ø§Ù‹ (Ø£Ø³Ø±Ø¹)
            try {
              const sessionData = sessionStorage.getItem('store_' + subdomain);
              if (sessionData) {
                const storeInfo = JSON.parse(sessionData);
                if (storeInfo.name) {
                  return {
                    name: storeInfo.name,
                    description: storeInfo.description,
                    source: 'sessionStorage'
                  };
                }
              }
            } catch (e) {}
            
            // 2. Ø§Ù„Ø¨Ø­Ø« ÙÙŠ instant store cache
            try {
              const instantData = sessionStorage.getItem('instant_store_' + subdomain);
              if (instantData) {
                const storeInfo = JSON.parse(instantData);
                if (storeInfo.name) {
                  return {
                    name: storeInfo.name,
                    description: storeInfo.description,
                    source: 'instant-cache'
                  };
                }
              }
            } catch (e) {}
            
            // 3. Ø§Ù„Ø¨Ø­Ø« ÙÙŠ localStorage Ù„Ù„Ù…Ø¤Ø³Ø³Ø©
            try {
              const organizationId = localStorage.getItem('bazaar_organization_id');
              if (organizationId) {
                const orgData = localStorage.getItem('bazaar_organization_' + organizationId);
                if (orgData) {
                  const parsed = JSON.parse(orgData);
                  if (parsed.name && parsed.subdomain === subdomain) {
                    return {
                      name: parsed.name,
                      description: parsed.description,
                      source: 'localStorage-org'
                    };
                  }
                }
                
                const orgSettings = localStorage.getItem('bazaar_org_settings_' + organizationId);
                if (orgSettings) {
                  const parsed = JSON.parse(orgSettings);
                  if (parsed.site_name) {
                    return {
                      name: parsed.site_name,
                      description: parsed.seo_meta_description,
                      source: 'localStorage-settings'
                    };
                  }
                }
              }
            } catch (e) {}
            
            // 4. Ø§Ù„Ø¨Ø­Ø« ÙÙŠ store_quick cache
            try {
              const quickData = localStorage.getItem('store_quick_' + subdomain);
              if (quickData) {
                const storeInfo = JSON.parse(quickData);
                if (storeInfo.name) {
                  return {
                    name: storeInfo.name,
                    description: storeInfo.description,
                    source: 'quick-cache'
                  };
                }
              }
            } catch (e) {}
            
            // 5. Ø§Ù„Ø¨Ø­Ø« ÙÙŠ early preload
            try {
              const earlyPreload = localStorage.getItem('early_preload_' + subdomain);
              if (earlyPreload) {
                const data = JSON.parse(earlyPreload);
                const orgDetails = data.data && data.data.organization_details;
                const orgSettings = data.data && data.data.organization_settings;
                
                if ((orgDetails && orgDetails.name) || (orgSettings && orgSettings.site_name)) {
                  return {
                    name: (orgDetails && orgDetails.name) || (orgSettings && orgSettings.site_name),
                    description: (orgDetails && orgDetails.description) || (orgSettings && orgSettings.seo_meta_description),
                    source: 'early-preload'
                  };
                }
              }
            } catch (e) {}
            
            // 6. Ø§Ø³ØªØ®Ø¯Ø§Ù… subdomain ÙƒØ§Ø³Ù… Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù…Ø¹ ØªØ­Ø³ÙŠÙ†
            if (subdomain && subdomain.length > 2) {
              // ØªØ­ÙˆÙŠÙ„ subdomain Ø¥Ù„Ù‰ Ø§Ø³Ù… Ø£ÙƒØ«Ø± Ù‚Ø§Ø¨Ù„ÙŠØ© Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©
              let displayName = subdomain;
              
              // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø±Ù…ÙˆØ² Ø§Ù„ØºØ±ÙŠØ¨Ø©
              displayName = displayName.replace(/[0-9\-_]/g, ' ');
              
              // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø£ÙˆÙ„ Ø¥Ù„Ù‰ capital
              displayName = displayName.charAt(0).toUpperCase() + displayName.slice(1);
              
              // Ø¥Ø¶Ø§ÙØ© "Ù…ØªØ¬Ø±" Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø³Ù… Ù‚ØµÙŠØ±
              if (displayName.length < 5) {
                displayName = 'Ù…ØªØ¬Ø± ' + displayName;
              }
              
              return {
                name: displayName,
                description: 'Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…ØªØ®ØµØµ',
                source: 'subdomain'
              };
            }
            
            return null;
          } catch (error) {
            return null;
          }
        }
        
        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ†
        function updateFavicon(iconUrl, fallbackName) {
          try {
            // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
            document.querySelectorAll('link[rel*="icon"]').forEach(el => el.remove());
            
            const favicon = document.createElement('link');
            favicon.rel = 'icon';
            favicon.type = 'image/x-icon';
            
            if (iconUrl && iconUrl.trim()) {
              // Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙØ§ÙÙŠÙƒÙˆÙ† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
              favicon.href = iconUrl.includes('?') ? iconUrl : iconUrl + '?v=' + Date.now();
            } else {
              // Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ÙÙŠÙƒÙˆÙ† SVG Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø¨Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø£ÙˆÙ„ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±
              const initial = (fallbackName || 'Ù…').charAt(0);
              const svgIcon = `
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                  <defs>
                    <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
                      <stop offset="0%" style="stop-color:#22c55e;stop-opacity:1" />
                      <stop offset="100%" style="stop-color:#16a34a;stop-opacity:1" />
                    </linearGradient>
                  </defs>
                  <circle cx="50" cy="50" r="45" fill="url(#grad)" stroke="#ffffff" stroke-width="2"/>
                  <text x="50" y="50" text-anchor="middle" dominant-baseline="central" 
                        font-family="system-ui, -apple-system, sans-serif" 
                        font-size="40" font-weight="bold" fill="#ffffff">${initial}</text>
                </svg>
              `;
              
              const encodedSvg = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgIcon)));
              favicon.href = encodedSvg;
            }
            
            document.head.appendChild(favicon);
            
            // Ø¥Ø¶Ø§ÙØ© Ø£ÙŠØ¶Ø§Ù‹ icon Ù„Ù€ Safari/iOS
            const appleTouchIcon = document.createElement('link');
            appleTouchIcon.rel = 'apple-touch-icon';
            appleTouchIcon.href = favicon.href;
            document.head.appendChild(appleTouchIcon);
            
          } catch (error) {
            console.warn('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ†:', error);
          }
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± ÙÙˆØ±Ø§Ù‹
        function applyInstantStoreTitle() {
          const storeInfo = getInstantStoreName();
          
          if (storeInfo && storeInfo.name) {
            // ØªØ¹ÙŠÙŠÙ† Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© ÙÙˆØ±Ø§Ù‹
            document.title = storeInfo.name;
            
            // ØªØ­Ø¯ÙŠØ« meta description Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆÙØ±Ø§Ù‹
            if (storeInfo.description) {
              const existingDescription = document.querySelector('meta[name="description"]');
              if (existingDescription) {
                existingDescription.content = storeInfo.description;
              }
            }
            
            // ØªØ­Ø¯ÙŠØ« Open Graph tags Ù„Ù€ Facebook
            const updateOGMeta = (property, content) => {
              if (!content) return;
              let meta = document.querySelector(`meta[property="${property}"]`);
              if (!meta) {
                meta = document.createElement('meta');
                meta.setAttribute('property', property);
                document.head.appendChild(meta);
              }
              meta.setAttribute('content', content);
            };
            
            updateOGMeta('og:title', storeInfo.name);
            updateOGMeta('og:description', storeInfo.description || 'Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…ØªØ®ØµØµ');
            updateOGMeta('og:type', 'website');
            updateOGMeta('og:site_name', storeInfo.name);
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© updateFavicon Ø§Ù„Ù…ÙØ¹Ø±Ù‘ÙØ© Ø®Ø§Ø±Ø¬ÙŠØ§Ù‹
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† favicon URL ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            let faviconUrl = null;
            let logoUrl = null;
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ† Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…Ø®ØªÙ„ÙØ©
            try {
              const subdomain = getCurrentSubdomain();
              if (subdomain) {
                // 1. Ø§Ù„Ø¨Ø­Ø« ÙÙŠ favicon cache Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø£ÙˆÙ„Ø§Ù‹ (Ø£Ø³Ø±Ø¹)
                faviconUrl = localStorage.getItem('favicon_' + subdomain) || sessionStorage.getItem('favicon_' + subdomain);
                
                // 2. Ø§Ù„Ø¨Ø­Ø« ÙÙŠ store_quick cache
                if (!faviconUrl) {
                  const quickData = localStorage.getItem('store_quick_' + subdomain);
                  if (quickData) {
                    const parsed = JSON.parse(quickData);
                    faviconUrl = parsed.favicon_url;
                    logoUrl = parsed.logo_url;
                  }
                }
                
                // 3. Ø§Ù„Ø¨Ø­Ø« ÙÙŠ early_preload Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ ÙÙŠ quick cache
                if (!faviconUrl && !logoUrl) {
                  const earlyData = localStorage.getItem('early_preload_' + subdomain);
                  if (earlyData) {
                    const parsed = JSON.parse(earlyData);
                    faviconUrl = parsed.data?.organization_settings?.favicon_url;
                    logoUrl = parsed.data?.organization_settings?.logo_url || parsed.data?.organization_details?.logo_url;
                  }
                }
                
                // 4. Ø§Ù„Ø¨Ø­Ø« ÙÙŠ org settings
                const orgId = localStorage.getItem('bazaar_organization_id');
                if (orgId && (!faviconUrl && !logoUrl)) {
                  const orgSettings = localStorage.getItem('bazaar_org_settings_' + orgId);
                  if (orgSettings) {
                    const parsed = JSON.parse(orgSettings);
                    faviconUrl = parsed.favicon_url;
                    logoUrl = parsed.logo_url;
                  }
                }
              }
            } catch (e) {}
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ†
            updateFavicon(faviconUrl || logoUrl, storeInfo.name);
            
            // Ø­ÙØ¸ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³Ø±ÙŠØ¹
            const subdomain = getCurrentSubdomain();
            if (subdomain) {
              try {
                sessionStorage.setItem('instant_store_' + subdomain, JSON.stringify({
                  name: storeInfo.name,
                  description: storeInfo.description,
                  timestamp: Date.now()
                }));
              } catch (e) {}
            }
            
            return true;
          }
          
          return false;
        }
        
        // ØªØ´ØºÙŠÙ„ ÙÙˆØ±ÙŠ
        const success = applyInstantStoreTitle();
        
        // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¯ÙˆØ§Ù„ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù† React
        window.__INSTANT_STORE_UTILS__ = {
          getInstantStoreName: getInstantStoreName,
          applyInstantStoreTitle: applyInstantStoreTitle,
          getCurrentSubdomain: getCurrentSubdomain,
          updateFavicon: updateFavicon
        };
        
      })();
    </script>
    
    <!-- Favicon - Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
    <!-- ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ© Ù„ØªØ¬Ù†Ø¨ Ø¸Ù‡ÙˆØ± Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ† Ø§Ù„Ø£Ø®Ø¶Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ -->
    
    <!-- ğŸš€ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ù…Ø­Ø³Ù† Ù„Ù„Ø£Ø¯Ø§Ø¡ - Ø§Ø³ØªØ®Ø¯Ø§Ù… preload Ù…Ø¹ font-display -->
    <link rel="preload" href="/fonts/tajawal-regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
    <link rel="preload" href="/fonts/tajawal-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
    <link rel="preload" href="/fonts/tajawal-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
    
    <!-- ØªØ­Ù…ÙŠÙ„ CSS Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ - Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ -->
    <link rel="preload" href="/src/index.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/src/index.css"></noscript>
    
    <!-- ØªØ­Ø³ÙŠÙ† Ø¥Ø¶Ø§ÙÙŠ: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© -->
    <script nonce="{{CSP_NONCE}}">
      // Smart font loading strategy - Ù…Ø­Ø³Ù† Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªÙƒØ±Ø±
      (function() {
        // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø®Ø·ÙˆØ· ÙÙŠ Ø§Ù„ÙƒØ§Ø´
        var fontsAlreadyLoaded = sessionStorage.getItem('fonts_loaded');

        if (fontsAlreadyLoaded === 'true') {
          console.log('Fonts already preloaded, skipping...');
          return;
        }

        var fontsLoaded = false;

        // Function to load additional fonts
        function loadAdditionalFonts() {
          if (fontsLoaded) return;
          fontsLoaded = true;

          var additionalFonts = [
            '/fonts/tajawal-medium.woff2',
            '/fonts/tajawal-bold.woff2'
          ];

          additionalFonts.forEach(function(fontUrl) {
            var link = document.createElement('link');
            link.rel = 'prefetch';
            link.as = 'font';
            link.type = 'font/woff2';
            link.crossOrigin = 'anonymous';
            link.href = fontUrl;
            document.head.appendChild(link);
          });

          // Ø­ÙØ¸ ÙÙŠ sessionStorage Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªÙƒØ±Ø±
          sessionStorage.setItem('fonts_loaded', 'true');
          console.log('Fonts preloaded and cached for session');
        }

        // Load additional fonts on user interaction or after delay
        var events = ['mousedown', 'touchstart', 'keydown', 'wheel'];
        events.forEach(function(event) {
          document.addEventListener(event, loadAdditionalFonts, { once: true, passive: true });
        });

        // Fallback: load after 1 second if no interaction (Ø£Ù‚Ù„ Ù…Ù† 2s)
        setTimeout(loadAdditionalFonts, 1000);
      })();
    </script>
    
    <!-- Ø¥Ø¶Ø§ÙØ© Ø³ÙƒØ±ÙŠØ¨Øª Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© -->
    <script nonce="{{CSP_NONCE}}">
      // Ø­Ø§ÙˆÙ„ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ù‚Ø¨Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ù…Ù†Ø¹ ÙˆÙ…ÙŠØ¶ Ø§Ù„Ø´Ø§Ø´Ø©
      const storedTheme = localStorage.getItem('theme') || 'light';
      const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      const initialTheme = storedTheme === 'system' ? systemTheme : storedTheme;
      document.documentElement.classList.add(initialTheme);
      document.documentElement.style.colorScheme = initialTheme;
    </script>
    
    <!-- ğŸš€ Resource Hints Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ø£Ø¯Ø§Ø¡ -->
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="//api.vercel.com">
    
    <!-- ğŸš€ Preconnect Ù„Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø­Ø±Ø¬Ø© -->
    <link rel="preconnect" href="%VITE_SUPABASE_URL%" crossorigin>
    
    <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª JavaScript Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
    <script nonce="{{CSP_NONCE}}">
      // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø£Ø¯Ø§Ø¡
      window.process = window.process || { env: {} };
      window.global = window.global || window;
      
      // ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø®Ø·ÙˆØ·
      if ('fonts' in document) {
        document.fonts.ready.then(() => {
          document.documentElement.classList.add('fonts-loaded');
        });
      }
    </script>
    
    <!-- ğŸ¯ ØªØ­Ø³ÙŠÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ - Ø¥Ø²Ø§Ù„Ø© preload ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠ -->
    <!-- ØªÙ… Ø¥Ø²Ø§Ù„Ø© preload Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙŠ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Vite ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
    
    <!-- âŒ Ø¥Ø²Ø§Ù„Ø© Google Fonts: Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙ‚Ø· Ù„Ù„Ø£Ø¯Ø§Ø¡ -->
    
    <!-- ğŸš€ Critical CSS will be loaded via React imports -->
    
    <!-- ğŸš€ CRITICAL CSS INLINE (Ù…ØµØºÙ‘Ø± Ø¬Ø¯Ø§Ù‹: Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª ÙˆØ§Ù„Ù„ÙˆØ¯Ø± ÙÙ‚Ø·) -->
    <style>
      html {
        font-family: 'Tajawal', 'Arial Unicode MS', 'Tahoma', 'Arial', sans-serif;
        line-height: 1.5;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      body {
        margin: 0;
        padding: 0;
        direction: rtl;
        text-align: right;
        min-height: 100vh;
        background: #ffffff;
        color: #000000;
        overflow-x: hidden;
      }
      #root { min-height: 100vh; }
      .loading-container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
        padding: 1rem;
        border-radius: 0.5rem;
        background: #ffffff;
      }
      .loading-spinner {
        width: 32px;
        height: 32px;
        border: 2px solid #e5e7eb;
        border-top-color: #6b21a8;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }
      @keyframes spin { to { transform: rotate(360deg); } }
      * { box-sizing: border-box; }
    </style>

    <!-- ğŸš€ ØªØ­Ù…ÙŠÙ„ CSS Ù…Ø­Ø³Ù† Ù„ØªÙ‚Ù„ÙŠÙ„ Render Blocking (ØªØ¹Ø·ÙŠÙ„ ÙÙŠ Ø§Ù„ØªØ·ÙˆÙŠØ±) -->
    <script nonce="{{CSP_NONCE}}">
      (function(){
        // Ù„Ø§ ØªÙØ­Ù…Ù‘ÙÙ„ CSS Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ ÙÙŠ Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ·ÙˆÙŠØ± (localhost/127.*)
        var host = location.hostname || '';
        // Ø§Ø¹ØªØ¨Ø± subdomain.localhost Ø¨ÙŠØ¦Ø© ØªØ·ÙˆÙŠØ± Ø£ÙŠØ¶Ø§Ù‹ (asraycollection.localhost)
        var isDev = host === 'localhost' || host.endsWith('.localhost') || host.indexOf('127.') === 0 || host === '::1' || host === '0.0.0.0';
        if (isDev) return;

        // ØªØ­Ù…ÙŠÙ„ CSS Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
        function loadNonCriticalCSS() {
          // ØªØ­Ù…ÙŠÙ„ CSS Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ù…ÙÙ†ØªØ¬ Ù…Ù† Vite
          var mainCSS = document.querySelector('link[rel="stylesheet"][href*="main-"]');
          if (!mainCSS) {
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ CSS Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØŒ Ø§Ø¨Ø­Ø« Ø¹Ù†Ù‡ ÙˆØ­Ù…Ù‘Ù„Ù‡
            loadCSS('/assets/css/main-CbztG7-1.css');
          }
        }

        function loadCSS(href) {
          var link = document.createElement('link');
          link.rel = 'stylesheet';
          link.href = href;
          link.media = 'print';
          link.onload = function(){ this.media = 'all'; this.onload = null; };
          link.onerror = function(){ console.warn('Failed to load CSS:', href); };
          document.head.appendChild(link);
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', loadNonCriticalCSS);
        } else {
          loadNonCriticalCSS();
        }
      })();
    </script>

    <meta property="og:title" content="Ø³Ø·ÙˆÙƒÙŠÙ‡Ø§ - Ù…Ù†ØµØ© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ø°ÙƒÙŠØ©" />
    <meta property="og:description" content="Ù…Ù†ØµØ© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ø°ÙƒÙŠØ© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…ØªØ¬Ø±Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø©" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/images/logo-new.webp" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@stockiha" />
    <meta name="twitter:image" content="/images/logo-new.webp" />
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#6b21a8">
    
    <!-- Ù…Ø®ØµØµ Ù„Ù€ Vercel Ùˆ SPA -->
    <meta name="vercel-deployment" content="true">
    <meta name="format-detection" content="telephone=no">
  </head>

  <body>
    <div id="root">
      <!-- PERFORMANCE OPTIMIZATION: Loading screen for better perceived performance -->
      <div class="loading-container" id="initial-loading">
        <div class="loading-spinner"></div>
      </div>
    </div>

    <!-- Remove loading screen when React loads -->
    <script nonce="{{CSP_NONCE}}">
      // ğŸš€ Ø¯Ø§Ù„Ø© Ø¹Ø§Ù…Ø© Ù„Ø¥Ø²Ø§Ù„Ø© Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ - Ø³ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ù…Ù† React
      window.removeInitialLoading = function() {
        const loadingScreen = document.getElementById('initial-loading');
        if (loadingScreen) {
          loadingScreen.style.opacity = '0';
          loadingScreen.style.transition = 'opacity 0.15s ease'; // âœ… ØªÙ‚Ù„ÙŠÙ„ Ù…Ù† 0.3s Ø¥Ù„Ù‰ 0.15s
          setTimeout(() => {
            if (loadingScreen.parentNode) {
              loadingScreen.remove();
            }
          }, 150); // âœ… ØªÙ‚Ù„ÙŠÙ„ Ù…Ù† 300ms Ø¥Ù„Ù‰ 150ms Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
        }
      };

      // â›‘ï¸ Ø§Ø­ØªÙŠØ§Ø·: Ø¥Ø²Ø§Ù„Ø© Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ù…Ù‡Ù„Ø© Ù‚ØµÙŠØ±Ø© Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ÙŠØ³ØªØ¯Ø¹Ù‡Ø§ React
      setTimeout(() => {
        try { if (typeof window.removeInitialLoading === 'function') window.removeInitialLoading(); } catch {}
      }, 2500);

      // ğŸš€ ØªØ­Ø¯ÙŠØ« Ù…Ø¨ÙƒØ± Ù„Ù„Ø¹Ù†ÙˆØ§Ù†/Ø§Ù„ÙˆØµÙ/Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ cache Ø£Ùˆ Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù†Ø·Ø§Ù‚
      const earlyHeadUpdate = () => {
        try {
          const hostname = window.location.hostname;
          
          // ÙØ­Øµ Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
          const isPublicDomain = ['ktobi.online', 'www.ktobi.online', 'stockiha.com', 'www.stockiha.com', 'stockiha.pages.dev'].includes(hostname);
          
          // Ù„Ø§ Ù†Ø¹Ø¯Ù„ Ø´ÙŠØ¦Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„Ø¹Ø§Ù… (ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØµØ©)
          if (isPublicDomain) return;

          // Ø§Ø³ØªÙ†ØªØ§Ø¬ Ù…Ø¹Ø±Ù Ø§Ù„Ù…ØªØ¬Ø± Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
          const baseDomains = ['.ktobi.online', '.stockiha.com'];
          const isLocalhost = hostname.includes('localhost') || hostname.startsWith('127.');
          const isBaseDomain = baseDomains.some(d => hostname.endsWith(d));
          const isCustomDomain = !isLocalhost && !isBaseDomain;

          let storeIdentifier = '';
          if (isCustomDomain) {
            storeIdentifier = hostname.startsWith('www.') ? hostname.substring(4) : hostname;
          } else if (isBaseDomain) {
            const parts = hostname.split('.');
            if (parts.length > 2 && parts[0] !== 'www') storeIdentifier = parts[0];
          } else if (isLocalhost && hostname.includes('.')) {
            const parts = hostname.split('.');
            if (parts.length > 1 && parts[0] !== 'localhost') storeIdentifier = parts[0];
          }

          // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ØµØºÙŠØ±Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ† ÙˆØ§Ù„Ù…ÙŠØªØ§
          const setFavicon = (iconUrl, name) => {
            try {
              // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø³Ø§Ø¨Ù‚Ø© Ù„ØªÙØ§Ø¯ÙŠ Ø§Ù„ØªÙƒØ±Ø§Ø±
              document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]').forEach(el => el.remove());
              const link = document.createElement('link');
              link.rel = 'icon';
              link.type = 'image/x-icon';
              if (iconUrl) {
                link.href = `${iconUrl}?v=${Date.now()}`;
              } else {
                const initial = (name || 'Ù…').charAt(0);
                const svg = `
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                    <defs>
                      <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#22c55e;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#16a34a;stop-opacity:1" />
                      </linearGradient>
                    </defs>
                    <rect width="100" height="100" rx="20" fill="url(#grad)"/>
                    <path d="M25 35h50l-5 30H30z" fill="white" opacity="0.9"/>
                    <circle cx="35" cy="75" r="5" fill="white"/>
                    <circle cx="65" cy="75" r="5" fill="white"/>
                    <path d="M35 25l5 10h20l5-10" stroke="white" stroke-width="3" fill="none"/>
                    <text x="50" y="55" text-anchor="middle" font-family="Arial" font-size="38" font-weight="bold" fill="white">${initial}</text>
                  </svg>
                `;
                link.href = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svg)));
              }
              document.head.appendChild(link);
              // Ø¥Ø¶Ø§ÙØ© shortcut icon Ù„Ø¯Ø¹Ù… Ø£ÙˆØ³Ø¹
              const shortcut = link.cloneNode();
              shortcut.rel = 'shortcut icon';
              document.head.appendChild(shortcut);
            } catch {}
          };

          const setMeta = (desc, title, ogImage) => {
            try {
              if (title) document.title = title;
              if (desc) {
                let m = document.querySelector('meta[name="description"]');
                if (!m) { m = document.createElement('meta'); m.setAttribute('name','description'); document.head.appendChild(m); }
                m.setAttribute('content', desc);
              }
              if (title) {
                let ogt = document.querySelector('meta[property="og:title"]');
                if (!ogt) { ogt = document.createElement('meta'); ogt.setAttribute('property','og:title'); document.head.appendChild(ogt); }
                ogt.setAttribute('content', title);
              }
              if (desc) {
                let ogd = document.querySelector('meta[property="og:description"]');
                if (!ogd) { ogd = document.createElement('meta'); ogd.setAttribute('property','og:description'); document.head.appendChild(ogd); }
                ogd.setAttribute('content', desc);
              }
              if (ogImage) {
                let ogi = document.querySelector('meta[property="og:image"]');
                if (!ogi) { ogi = document.createElement('meta'); ogi.setAttribute('property','og:image'); document.head.appendChild(ogi); }
                ogi.setAttribute('content', ogImage);
              }
            } catch {}
          };

          // 0) Ø¥Ù† ØªÙ… Ø­Ù‚Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†ØªØ¬ Ù…Ù† Cloudflare WorkerØŒ Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ ÙÙˆØ±Ø§Ù‹
          try {
            const pre = document.getElementById('__PRELOADED_PRODUCT__');
            if (pre && pre.textContent) {
              const json = JSON.parse(pre.textContent.trim());
              const data = json?.data || null;
              const p = data?.product || data || null;
              const pname = p?.name || null;
              const pdesc = (p?.description || '').toString().replace(/<[^>]*>/g, '').trim().slice(0, 140);
              const pimg = p?.images?.thumbnail_image || (p?.images?.additional_images && p?.images?.additional_images[0]?.url) || null;
              if (pname) {
                // Ù„Ø§ ØªØºÙŠÙ‘Ø± Ø¥Ù† ÙƒØ§Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙØ¹Ù„ (Ø­Ù‚Ù† Ø§Ù„Ø­Ø§ÙØ© Ø³Ø¨Ù‚Ù†Ø§)
                if (!document.title || !document.title.includes(pname)) {
                  setMeta(pdesc || '', pname, pimg || '');
                }
                return;
              }
            }
          } catch {}

          // 1) Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹
          if (storeIdentifier) {
            const keysToTry = [
              `early_preload_${storeIdentifier}`,
              // ÙÙŠ Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ© Ø¬Ø±Ù‘Ø¨ Ø£ÙŠØ¶Ø§Ù‹ Ø£ÙˆÙ„ Ø¬Ø²Ø¡ ÙƒÙ€ subdomain Ø§Ø­ØªÙŠØ§Ø·ÙŠ
              ...(isCustomDomain ? [`early_preload_${storeIdentifier.split('.')[0]}`] : [])
            ];
            for (const k of keysToTry) {
              const raw = localStorage.getItem(k) || sessionStorage.getItem(k);
              if (raw) {
                try {
                  const parsed = JSON.parse(raw);
                  const data = parsed?.data || parsed; // Ø¯Ø¹Ù… ÙƒÙ„Ø§ Ø§Ù„Ø´ÙƒÙ„ÙŠÙ†
                  const siteName = data?.organization_settings?.site_name || data?.organization_details?.name;
                  const seoTitle = data?.seo_meta?.title || siteName;
                  const seoDesc = data?.seo_meta?.description || data?.organization_details?.description;
                  const icon = data?.organization_settings?.favicon_url || data?.organization_settings?.logo_url || data?.organization_details?.logo_url;
                  const ogImage = data?.seo_meta?.image || data?.organization_settings?.logo_url || data?.organization_details?.logo_url;
                  if (seoTitle || seoDesc || icon) {
                    setMeta(seoDesc || '', seoTitle || siteName || '', ogImage || '');
                    setFavicon(icon, siteName);
                    return; // ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† Ø§Ù„Ù€ cache
                  }
                } catch {}
              }
            }
          }

          // 2) Ù„Ø§ ÙŠÙˆØ¬Ø¯ cache:
          // Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© (Ø¨Ø¯ÙˆÙ† subdomain) Ù„Ø§ Ù†Ø¨Ø¯Ù‘Ù„ Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ù†ØµØ©
          if (!storeIdentifier) {
            // Ø§ØªØ±Ùƒ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ÙØ§ÙÙŠÙƒÙˆÙ† Ø§Ù„Ø«Ø§Ø¨ØªØ© Ù…Ù† index.html ÙƒÙ…Ø§ Ù‡ÙŠ
            // ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙ‚Ø· Ø¥Ù† Ø£Ø±Ø¯ØªØŒ Ù„ÙƒÙ† Ù„Ø§ ØªÙ„Ù…Ø³ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
            try {
              let rawName = hostname.startsWith('www.') ? hostname.substring(4) : hostname;
              const fallbackName = (rawName.split('.')[0] || 'Ù…ØªØ¬Ø±');
              if (!document.title || document.title === 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...') {
                document.title = `Ø³Ø·ÙˆÙƒÙŠÙ‡Ø§`;
              }
            } catch {}
            return;
          }

          // Ù†Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ØªØ§Ø¬Ø±: Ø¹Ù†ÙˆØ§Ù† ÙˆÙØ§ÙÙŠÙƒÙˆÙ† Ù…Ø­Ø§ÙŠØ¯Ø§Ù† Ø­ØªÙ‰ ÙŠØ¨Ø¯Ø£ React
          let rawName = hostname.startsWith('www.') ? hostname.substring(4) : hostname;
          const fallbackName = (rawName.split('.')[0] || 'Ù…ØªØ¬Ø±');
          // Ù„Ø§ ØªØ³Ø¨Ù‚ Ø§Ù„Ø§Ø³Ù… Ø¨ÙƒÙ„Ù…Ø© "Ù…ØªØ¬Ø±" Ù„ØªØ¬Ù†Ø¨ ÙˆÙ…ÙŠØ¶ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
          if (!document.title || document.title === 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...') {
            document.title = `${fallbackName}`;
          }
          setFavicon(null, fallbackName);
        } catch (error) {
          console.warn('Ø®Ø·Ø£ ÙÙŠ ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø¨ÙƒØ±:', error);
        }
      };

      // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¨ÙƒØ± Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹
      earlyHeadUpdate();
    </script>

    <!-- Store Application Entry -->
    <script type="module" src="/src/store-main.tsx"></script>


  </body>
</html>
