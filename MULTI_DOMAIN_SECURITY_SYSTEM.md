# ูุธุงู ุงูุฃูุงู ูุงูุฎุตูุตูุฉ ูุชุนุฏุฏ ุงููุทุงูุงุช
## Multi-Domain Security & Privacy System

### ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุฃูุงู ูุฎุตูุตูุฉ ุดุงูู ูุฏุนู ุงููุทุงูุงุช ุงููุชุนุฏุฏุฉ ูุงููุทุงูุงุช ุงููุฑุนูุฉ ูุน ุชูุงูู Google OAuth ููุตุงุฏูุฉ ุซูุงุฆูุฉ ูุชูุฏูุฉ.

### ๐๏ธ ุงููููู ุงูุนุงู

#### ุงููุทุงูุงุช ุงููุฏุนููุฉ:
- **stockiha.com** (ุงููุทุงู ุงูุฑุฆูุณู)
- **ktobi.online**
- **bazaar.com**
- **bazaar.dev**

#### ุงููุทุงูุงุช ุงููุฑุนูุฉ:
- ูู ุนููู ูุญุตู ุนูู ูุทุงู ูุฑุนู ูุฎุตุต
- ูุซุงู: `client1.stockiha.com`, `company2.ktobi.online`

### ๐ง ุงูููููุงุช ุงูุฑุฆูุณูุฉ

#### 1. ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
```sql
-- ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ
- user_security_settings      # ุฅุนุฏุงุฏุงุช ุงูุฃูุงู
- privacy_settings            # ุฅุนุฏุงุฏุงุช ุงูุฎุตูุตูุฉ  
- user_sessions              # ุงูุฌูุณุงุช ุงููุดุทุฉ
- security_logs              # ุณุฌู ุงูุฃูุดุทุฉ ุงูุฃูููุฉ
- trusted_devices            # ุงูุฃุฌูุฒุฉ ุงูููุซููุฉ
- verification_codes         # ุฑููุฒ ุงูุชุญูู
- supported_domains          # ุงููุทุงูุงุช ุงููุฏุนููุฉ
- client_subdomains          # ุงููุทุงูุงุช ุงููุฑุนูุฉ ููุนููุงุก
```

#### 2. ููููุงุช React
```typescript
- SecurityPrivacySettings.tsx  # ุงููููู ุงูุฑุฆูุณู
- PasswordSettings.tsx         # ุฅุนุฏุงุฏุงุช ูููุฉ ุงููุฑูุฑ
- ProfileSettings.tsx          # ุฅุนุฏุงุฏุงุช ุงูููู ุงูุดุฎุตู
- NotificationsSettings.tsx    # ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช
```

#### 3. APIs ูุงูุฎุฏูุงุช
```typescript
- src/lib/api/security.ts      # APIs ุงูุฃูุงู ูุงูุฎุตูุตูุฉ
- src/lib/api/profile.ts       # APIs ุงูููู ุงูุดุฎุตู
- src/hooks/useProfile.ts      # Hook ูุฎุตุต ููููู ุงูุดุฎุตู
```

### ๐ ููุฒุงุช ุงูุฃูุงู

#### ุงููุตุงุฏูุฉ ุงูุซูุงุฆูุฉ (2FA)
- **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู**: ุฑููุฒ ุชุญูู ุนุจุฑ ุงูุฅูููู
- **ุงูุฑุณุงุฆู ุงููุตูุฉ**: ุฑููุฒ SMS
- **ุชุทุจูู ุงููุตุงุฏูุฉ**: TOTP (Google Authenticator, Authy)
- **ุฑููุฒ ุงููุณุฎ ุงูุงุญุชูุงุทู**: ููุทูุงุฑุฆ

#### Google OAuth Integration
- ุฑุจุท/ุฅูุบุงุก ุฑุจุท ุญุณุงุจ Google
- ุชุณุฌูู ุฏุฎูู ุณุฑูุน
- ุฏุนู ุงููุทุงูุงุช ุงููุชุนุฏุฏุฉ
- ุฅุนุงุฏุฉ ุชูุฌูู ุขููุฉ

#### ุฅุฏุงุฑุฉ ุงูุฌูุณุงุช
- ุนุฑุถ ุงูุฌูุณุงุช ุงููุดุทุฉ
- ุฅููุงุก ุฌูุณุงุช ูุญุฏุฏุฉ
- ุฅููุงุก ุฌููุน ุงูุฌูุณุงุช ุงูุฃุฎุฑู
- ุชุชุจุน ูุนูููุงุช ุงูุฌูุงุฒ ูุงููููุน

#### ุงูุฃุฌูุฒุฉ ุงูููุซููุฉ
- ุชุณุฌูู ุงูุฃุฌูุฒุฉ ุงูููุซููุฉ
- ูุณุชููุงุช ุงูุซูุฉ (0-100%)
- ุฅุฒุงูุฉ ุงูุฃุฌูุฒุฉ
- ุชุชุจุน ุงูุงุณุชุฎุฏุงู

### ๐ก๏ธ ููุฒุงุช ุงูุฎุตูุตูุฉ

#### ุฅุนุฏุงุฏุงุช ุงูุฑุคูุฉ
- **ุนุงู**: ูุฑุฆู ููุฌููุน
- **ุงููุคุณุณุฉ**: ูุฑุฆู ูุฃุนุถุงุก ุงููุคุณุณุฉ ููุท
- **ุฎุงุต**: ูุฑุฆู ูููุณุชุฎุฏู ููุท

#### ุงูุชุญูู ูู ุงูุจูุงูุงุช
- ุฅุธูุงุฑ/ุฅุฎูุงุก ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- ุฅุธูุงุฑ/ุฅุฎูุงุก ุฑูู ุงููุงุชู
- ุฅุธูุงุฑ/ุฅุฎูุงุก ุขุฎุฑ ูุดุงุท
- ุฅุธูุงุฑ/ุฅุฎูุงุก ุงูุญุงูุฉ ุงูุญุงููุฉ

#### ุฅุนุฏุงุฏุงุช ุฌูุน ุงูุจูุงูุงุช
- ุงูุณูุงุญ ุจุฌูุน ุงูุจูุงูุงุช
- ุงูุณูุงุญ ุจุงูุชุญูููุงุช
- ุฑุณุงุฆู ุงูุชุณููู
- ุชุญุฏูุซุงุช ุงูููุชุฌ

### ๐ ุณุฌู ุงูุฃูุดุทุฉ ุงูุฃูููุฉ

#### ุฃููุงุน ุงูุฃูุดุทุฉ ุงููุณุฌูุฉ:
- ุชุณุฌูู ุงูุฏุฎูู/ุงูุฎุฑูุฌ
- ุชุบููุฑ ูููุฉ ุงููุฑูุฑ
- ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช
- ุฑุจุท/ุฅูุบุงุก ุฑุจุท ุงูุญุณุงุจุงุช
- ุฅููุงุก ุงูุฌูุณุงุช
- ุฅุถุงูุฉ/ุฅุฒุงูุฉ ุงูุฃุฌูุฒุฉ ุงูููุซููุฉ

#### ูุณุชููุงุช ุงููุฎุงุทุฑ:
- **ููุฎูุถ**: ุฃูุดุทุฉ ุนุงุฏูุฉ
- **ูุชูุณุท**: ุชุบููุฑุงุช ูููุฉ
- **ุนุงูู**: ุฃูุดุทุฉ ุญุณุงุณุฉ
- **ุญุฑุฌ**: ุชูุฏูุฏุงุช ุฃูููุฉ

### ๐ง ุฅุนุฏุงุฏ ุงููุธุงู

#### 1. ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
# ุชุทุจูู migrations
supabase db push

# ุฃู ุชุดุบูู ุงููููุงุช ูุฏููุงู
psql -f supabase/migrations/create_security_privacy_tables.sql
```

#### 2. ุฅุนุฏุงุฏ Google OAuth
```bash
# ุฅุถุงูุฉ ูุชุบูุฑุงุช ุงูุจูุฆุฉ
GOOGLE_CLIENT_ID="your-client-id"
GOOGLE_CLIENT_SECRET="your-client-secret"
```

#### 3. ุฅุนุฏุงุฏ ุงููุทุงูุงุช
```bash
# ุชุญุฏูุซ ููู config.toml
# ุฅุถุงูุฉ ุงููุทุงูุงุช ุงูุฌุฏูุฏุฉ ูู additional_redirect_urls
```

### ๐ ุงูุงุณุชุฎุฏุงู

#### ูู ูููู React:
```tsx
import { SecurityPrivacySettings } from '@/components/settings/SecurityPrivacySettings';

function SettingsPage() {
  return (
    <div>
      <SecurityPrivacySettings />
    </div>
  );
}
```

#### ุงุณุชุฎุฏุงู APIs:
```typescript
import { 
  getSecuritySettings,
  updateSecuritySettings,
  linkGoogleAccount 
} from '@/lib/api/security';

// ุฌูุจ ุฅุนุฏุงุฏุงุช ุงูุฃูุงู
const settings = await getSecuritySettings();

// ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช
await updateSecuritySettings({
  two_factor_enabled: true,
  login_notification_enabled: true
});

// ุฑุจุท ุญุณุงุจ Google
await linkGoogleAccount();
```

### ๐ ูุฑุงูุจุฉ ุงููุธุงู

#### ุฏูุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูููุฑุงูุจุฉ:
```sql
-- ุชูุธูู ุงูุฌูุณุงุช ุงูููุชููุฉ
SELECT cleanup_expired_sessions();

-- ุชูุธูู ุฑููุฒ ุงูุชุญูู
SELECT cleanup_expired_verification_codes();

-- ุงูุชุญูู ูู ููุฉ ูููุฉ ุงููุฑูุฑ
SELECT check_password_strength('MyPassword123!');

-- ุงูุชุญูู ูู ุตุญุฉ ุงููุทุงู ุงููุฑุนู
SELECT validate_subdomain('client1', 'stockiha.com');
```

#### ุฅุญุตุงุฆูุงุช ุงูุฃูุงู:
```sql
-- ุนุฏุฏ ุงููุญุงููุงุช ุงููุงุดูุฉ
SELECT COUNT(*) FROM security_logs 
WHERE status = 'failed' 
AND created_at > NOW() - INTERVAL '24 hours';

-- ุงูุฃูุดุทุฉ ุนุงููุฉ ุงููุฎุงุทุฑ
SELECT * FROM security_logs 
WHERE risk_level IN ('high', 'critical')
ORDER BY created_at DESC;
```

### ๐๏ธ ุงูุตูุงูุฉ ูุงูุชุญุฏูุซ

#### ููุงู ุฏูุฑูุฉ:
```sql
-- ุชุดุบูู ูููู: ุชูุธูู ุงูุจูุงูุงุช ุงูููุชููุฉ ุงูุตูุงุญูุฉ
SELECT cleanup_expired_sessions();
SELECT cleanup_expired_verification_codes();

-- ุชุดุบูู ุฃุณุจูุนู: ุชุญููู ุงูุฃูุดุทุฉ ุงูุฃูููุฉ
SELECT activity_type, COUNT(*) as count
FROM security_logs 
WHERE created_at > NOW() - INTERVAL '7 days'
GROUP BY activity_type;
```

#### ุฅุถุงูุฉ ูุทุงู ุฌุฏูุฏ:
```sql
-- ุฅุถุงูุฉ ูุทุงู ูุฏุนูู ุฌุฏูุฏ
INSERT INTO supported_domains (domain, is_active) 
VALUES ('newdomain.com', true);

-- ุฅุถุงูุฉ ูุทุงู ูุฑุนู ููุนููู
INSERT INTO client_subdomains (subdomain, domain_id, organization_id)
VALUES ('client1', (SELECT id FROM supported_domains WHERE domain = 'newdomain.com'), 'org-uuid');
```

### ๐ ุฃูุถู ุงูููุงุฑุณุงุช ุงูุฃูููุฉ

#### ูููุทูุฑูู:
1. **ุงุณุชุฎุฏู HTTPS ุฏุงุฆูุงู** ูู ุงูุฅูุชุงุฌ
2. **ูุนูู RLS** ุนูู ุฌููุน ุงูุฌุฏุงูู ุงูุญุณุงุณุฉ
3. **ุณุฌูู ุฌููุน ุงูุฃูุดุทุฉ ุงูุฃูููุฉ** ุจุงุณุชุฎุฏุงู `logSecurityActivity()`
4. **ุชุญูู ูู ุตุญุฉ ุงููุฏุฎูุงุช** ูุจู ุงููุนุงูุฌุฉ
5. **ุงุณุชุฎุฏู tokens ุขููุฉ** ููุฌูุณุงุช

#### ูููุฏูุฑูู:
1. **ุฑุงูุจ ุณุฌู ุงูุฃูุดุทุฉ** ุจุงูุชุธุงู
2. **ูุนูู ุงูุชูุจููุงุช** ููุฃูุดุทุฉ ุงููุดุจููุฉ
3. **ุญุฏูุซ ูููุงุช ุงููุฑูุฑ** ุฏูุฑูุงู
4. **ุฑุงุฌุน ุงูุฃุฌูุฒุฉ ุงูููุซููุฉ** ุดูุฑูุงู
5. **ูุธูู ุงูุจูุงูุงุช ุงูููุชููุฉ ุงูุตูุงุญูุฉ** ุฃุณุจูุนูุงู

### ๐ ุงูููุงููุณ ูุงูุชุญูููุงุช

#### ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูุฑุฆูุณูุฉ:
- ูุนุฏู ูุฌุงุญ ุชุณุฌูู ุงูุฏุฎูู
- ุนุฏุฏ ุงูุฌูุณุงุช ุงููุดุทุฉ
- ูุนุฏู ุงุณุชุฎุฏุงู 2FA
- ุนุฏุฏ ุงูุฃูุดุทุฉ ุงููุดุจููุฉ
- ูุนุฏู ุฑุจุท ุญุณุงุจุงุช Google

#### ุชูุงุฑูุฑ ุฏูุฑูุฉ:
- ุชูุฑูุฑ ุฃุณุจูุนู ููุฃูุดุทุฉ ุงูุฃูููุฉ
- ุชูุฑูุฑ ุดูุฑู ูุงุณุชุฎุฏุงู ุงููุธุงู
- ุชูุฑูุฑ ุฑุจุน ุณููู ูููุฎุงุทุฑ ุงูุฃูููุฉ

### ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

#### ูุดุงูู ุดุงุฆุนุฉ:

**1. ุฎุทุฃ redirect_uri_mismatch**
```bash
# ุงูุญู: ุชุฃูุฏ ูู ุฅุถุงูุฉ ุฌููุน URIs ูู Google Console
https://stockiha.com/auth/callback
https://client1.stockiha.com/auth/callback
```

**2. ุฎุทุฃ RLS Policy**
```sql
-- ุงูุญู: ุชุญูู ูู ุณูุงุณุงุช ุงูุฃูุงู
SELECT * FROM pg_policies WHERE tablename = 'user_security_settings';
```

**3. ุฎุทุฃ ูู ุชุณุฌูู ุงูุฃูุดุทุฉ**
```sql
-- ุงูุญู: ุชุญูู ูู ุฏุงูุฉ log_security_activity
SELECT log_security_activity(
  'user-uuid',
  'test_activity',
  'ุงุฎุชุจุงุฑ ุชุณุฌูู ุงููุดุงุท'
);
```

### ๐ ุงูุฏุนู ูุงููุณุงุนุฏุฉ

ููุญุตูู ุนูู ุงููุณุงุนุฏุฉ:
1. ุฑุงุฌุน ูุฐุง ุงูุฏููู ุฃููุงู
2. ุชุญูู ูู ุณุฌู ุงูุฃุฎุทุงุก ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ุฑุงุฌุน ุฅุนุฏุงุฏุงุช Google OAuth
4. ุชุฃูุฏ ูู ุตุญุฉ ูุชุบูุฑุงุช ุงูุจูุฆุฉ

### ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

#### ุงูููุฒุงุช ุงููุฎุทุทุฉ:
- [ ] ูุตุงุฏูุฉ ุจุงูุจุตูุฉ ุงูุญูููุฉ
- [ ] ุชุดููุฑ end-to-end ููุฑุณุงุฆู
- [ ] ูุธุงู ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ ุงููุชูุฏู
- [ ] ุชูุงูู ูุน ุฎุฏูุงุช ุฃูููุฉ ุฎุงุฑุฌูุฉ
- [ ] ููุญุฉ ุชุญูู ุฃูููุฉ ูููุฏูุฑูู

---

**ุชู ุฅูุดุงุก ูุฐุง ุงููุธุงู ุจูุงุณุทุฉ ูุฑูู ุงูุชุทููุฑ ูู stockiha.com**
**ุขุฎุฑ ุชุญุฏูุซ: ุฏูุณูุจุฑ 2024** 